# ðŸ¤”ðŸ‘€ MySQL SQL é¢è¯•æŒ‡å—

![db (1)](Images/db%20(1).png)

# æ•°æ®åº“åŸºç¡€ä¸Žç†è®º



## SQL DB - å…³ç³»åž‹æ•°æ®åº“æ˜¯å¦‚ä½•å·¥ä½œçš„?

![arch_sqlyuanli](Images/arch_sqlyuanli-16352271184591.png)

 

## ä»Žæ•°æ®ç»“æž„è¯´èµ·


### æ—¶é—´å¤æ‚åº¦

å¯¹äºŽæ•°æ®åº“è€Œè¨€ï¼Œé‡è¦çš„ä¸æ˜¯æ•°æ®é‡ï¼Œè€Œæ˜¯å½“æ•°æ®é‡å¢žåŠ æ—¶è¿ç®—å¦‚ä½•å¢žåŠ ã€‚

æ—¶é—´å¤æ‚åº¦ç”¨æ¥æ£€éªŒæŸä¸ªç®—æ³•å¤„ç†ä¸€å®šé‡çš„æ•°æ®è¦èŠ±å¤šé•¿æ—¶é—´ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ä¼šç»™å‡ºç¡®åˆ‡çš„è¿ç®—æ¬¡æ•°ï¼Œä½†æ˜¯ç»™å‡ºçš„æ˜¯ä¸€ç§ç†å¿µã€‚

![sb-sql-learn-1](Images/sb-sql-learn-1.png)

* ç»¿ï¼šO(1)æˆ–è€…å«å¸¸æ•°é˜¶å¤æ‚åº¦ï¼Œä¿æŒä¸ºå¸¸æ•°ï¼ˆè¦ä¸äººå®¶å°±ä¸ä¼šå«å¸¸æ•°é˜¶å¤æ‚åº¦äº†ï¼‰ã€‚
* çº¢ï¼šO(log(n))å¯¹æ•°é˜¶å¤æ‚åº¦ï¼Œå³ä½¿åœ¨åäº¿çº§æ•°æ®é‡æ—¶ä¹Ÿå¾ˆä½Žã€‚
* ç²‰ï¼šæœ€ç³Ÿç³•çš„å¤æ‚åº¦æ˜¯ O(n^2)ï¼Œå¹³æ–¹é˜¶å¤æ‚åº¦ï¼Œè¿ç®—æ•°å¿«é€Ÿè†¨èƒ€ã€‚
* é»‘å’Œè“ï¼šå¦å¤–ä¸¤ç§å¤æ‚åº¦ï¼ˆçš„è¿ç®—æ•°ä¹Ÿæ˜¯ï¼‰å¿«é€Ÿå¢žé•¿ã€‚



å¦‚æžœè¦å¤„ç†2000æ¡å…ƒç´ ï¼š

* O(1) ç®—æ³•ä¼šæ¶ˆè€— 1 æ¬¡è¿ç®—
* O(log(n)) ç®—æ³•ä¼šæ¶ˆè€— 7 æ¬¡è¿ç®—
* O(n) ç®—æ³•ä¼šæ¶ˆè€— 2000 æ¬¡è¿ç®—
* O(n*log(n)) ç®—æ³•ä¼šæ¶ˆè€— 14,000 æ¬¡è¿ç®—
* O(n^2) ç®—æ³•ä¼šæ¶ˆè€— 4,000,000 æ¬¡è¿ç®—



### å½’å¹¶æŽ’åº

å¯¹äºŽæ•°æ®åº“ï¼Œä½ éœ€è¦ç†è§£è¿™ä¸ª sort() å‡½æ•°çš„å·¥ä½œåŽŸç†ã€‚

å½’å¹¶æŽ’åºæ˜¯æŠŠé—®é¢˜æ‹†åˆ†ä¸ºå°é—®é¢˜ï¼Œé€šè¿‡è§£å†³å°é—®é¢˜æ¥è§£å†³æœ€åˆçš„é—®é¢˜ï¼ˆæ³¨ï¼šè¿™ç§ç®—æ³•å«åˆ†æ²»æ³•ï¼Œå³ã€Žåˆ†è€Œæ²»ä¹‹ã€å„ä¸ªå‡»ç ´ã€ï¼‰



**ä¸ºä»€ä¹ˆæ˜¯å½’å¹¶æŽ’åº**ï¼Ÿ

* ä½ å¯ä»¥æ›´æ”¹ç®—æ³•ï¼Œä»¥ä¾¿äºŽèŠ‚çœå†…å­˜ç©ºé—´ï¼Œæ–¹æ³•æ˜¯ä¸åˆ›å»ºæ–°çš„åºåˆ—è€Œæ˜¯ç›´æŽ¥ä¿®æ”¹è¾“å…¥åºåˆ—ã€‚æ³¨ï¼šè¿™ç§ç®—æ³•å«ã€Ž**åŽŸåœ°ç®—æ³•**ã€(in-place algorithm)



* ä½ å¯ä»¥æ›´æ”¹ç®—æ³•ï¼Œä»¥ä¾¿äºŽåŒæ—¶ä½¿ç”¨ç£ç›˜ç©ºé—´å’Œå°‘é‡å†…å­˜è€Œé¿å…å·¨é‡ç£ç›˜ I/Oã€‚æ–¹æ³•æ˜¯åªå‘å†…å­˜ä¸­åŠ è½½å½“å‰å¤„ç†çš„éƒ¨åˆ†ã€‚åœ¨ä»…ä»…100MBçš„å†…å­˜ç¼“å†²åŒºå†…æŽ’åºä¸€ä¸ªå‡ ä¸ªGBçš„è¡¨æ—¶ï¼Œè¿™æ˜¯ä¸ªå¾ˆé‡è¦çš„æŠ€å·§ã€‚æ³¨ï¼šè¿™ç§ç®—æ³•å«ã€Ž**å¤–éƒ¨æŽ’åº**ã€(external sorting)ã€‚



* ä½ å¯ä»¥æ›´æ”¹ç®—æ³•ï¼Œä»¥ä¾¿äºŽåœ¨ å¤šå¤„ç†å™¨/å¤šçº¿ç¨‹/å¤šæœåŠ¡å™¨ ä¸Šè¿è¡Œã€‚æ¯”å¦‚ï¼Œåˆ†å¸ƒå¼åˆå¹¶æŽ’åºæ˜¯**Hadoop**ï¼ˆé‚£ä¸ªè‘—åçš„å¤§æ•°æ®æ¡†æž¶ï¼‰çš„å…³é”®ç»„ä»¶ä¹‹ä¸€ã€‚





### äºŒå‰æœç´¢æ ‘

æ•°æ®åº“ä¸­æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ï¼Œæ˜¯æˆ‘ä»¬æ— æ³•ä½¿ç”¨çŸ©é˜µï¼Œè½¬è€Œä½¿ç”¨äºŒå‰æœç´¢æ ‘(BST)



- äºŒå‰æœç´¢æ ‘åªéœ€ log(N) æ¬¡è¿ç®—ï¼Œè€Œå¦‚æžœä½ ç›´æŽ¥ä½¿ç”¨é˜µåˆ—åˆ™éœ€è¦ N æ¬¡è¿ç®—



### B+æ ‘ç´¢å¼•

æŸ¥æ‰¾ä¸€ä¸ªç‰¹å®šå€¼è¿™ä¸ªæ ‘æŒºå¥½ç”¨ï¼Œä½†æ˜¯å½“ä½ éœ€è¦**æŸ¥æ‰¾ä¸¤ä¸ªå€¼ä¹‹é—´çš„å¤šä¸ªå…ƒç´ **æ—¶ï¼Œå°±ä¼šæœ‰å¤§éº»çƒ¦äº†ã€‚ä½ çš„æˆæœ¬å°†æ˜¯ O(N)ï¼Œå› ä¸ºä½ å¿…é¡»æŸ¥æ‰¾æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»¥åˆ¤æ–­å®ƒæ˜¯å¦å¤„äºŽé‚£ 2 ä¸ªå€¼ä¹‹é—´ï¼ˆä¾‹å¦‚ï¼Œå¯¹æ ‘ä½¿ç”¨ä¸­åºéåŽ†ï¼‰ã€‚è€Œä¸”è¿™ä¸ªæ“ä½œä¸æ˜¯ç£ç›˜I/Oæœ‰åˆ©çš„ï¼Œå› ä¸ºä½ å¿…é¡»è¯»å–æ•´ä¸ªæ ‘ã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°é«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢æ–¹æ³•ã€‚



**å¦‚æžœä½ åœ¨æ•°æ®åº“ä¸­å¢žåŠ æˆ–åˆ é™¤ä¸€è¡Œ**ï¼ˆä»Žè€Œåœ¨ç›¸å…³çš„ B+æ ‘ç´¢å¼•é‡Œï¼‰ï¼š

- ä½ å¿…é¡»åœ¨B+æ ‘ä¸­çš„èŠ‚ç‚¹ä¹‹é—´ä¿æŒé¡ºåºï¼Œå¦åˆ™èŠ‚ç‚¹ä¼šå˜å¾—ä¸€å›¢ç³Ÿï¼Œä½ æ— æ³•ä»Žä¸­æ‰¾åˆ°æƒ³è¦çš„èŠ‚ç‚¹ã€‚
- ä½ å¿…é¡»å°½å¯èƒ½é™ä½ŽB+æ ‘çš„å±‚æ•°ï¼Œå¦åˆ™ O(log(N)) å¤æ‚åº¦ä¼šå˜æˆ O(N)ã€‚



æ¢å¥è¯è¯´ï¼ŒB+æ ‘éœ€è¦è‡ªæˆ‘æ•´ç†å’Œè‡ªæˆ‘å¹³è¡¡ã€‚è°¢å¤©è°¢åœ°ï¼Œæˆ‘ä»¬æœ‰æ™ºèƒ½åˆ é™¤å’Œæ’å…¥ã€‚ä½†æ˜¯è¿™æ ·ä¹Ÿå¸¦æ¥äº†æˆæœ¬ï¼šåœ¨B+æ ‘ä¸­ï¼Œæ’å…¥å’Œåˆ é™¤æ“ä½œæ˜¯ O(log(N)) å¤æ‚åº¦ã€‚æ‰€ä»¥æœ‰äº›äººå¬åˆ°è¿‡ä½¿ç”¨å¤ªå¤šç´¢å¼•ä¸æ˜¯ä¸ªå¥½ä¸»æ„è¿™ç±»è¯´æ³•ã€‚æ²¡é”™ï¼Œä½ å‡æ…¢äº†å¿«é€Ÿæ’å…¥/æ›´æ–°/åˆ é™¤è¡¨ä¸­çš„ä¸€ä¸ªè¡Œçš„æ“ä½œï¼Œå› ä¸ºæ•°æ®åº“éœ€è¦ä»¥ä»£ä»·é«˜æ˜‚çš„æ¯ç´¢å¼• O(log(N)) è¿ç®—æ¥æ›´æ–°è¡¨çš„ç´¢å¼•ã€‚å†è€…ï¼Œå¢žåŠ ç´¢å¼•æ„å‘³ç€ç»™äº‹åŠ¡ç®¡ç†å™¨å¸¦æ¥æ›´å¤šçš„å·¥ä½œè´Ÿè·ï¼ˆåœ¨æœ¬æ–‡ç»“å°¾æˆ‘ä»¬ä¼šæŽ¢è®¨è¿™ä¸ªç®¡ç†å™¨ï¼‰ã€‚



### å“ˆå¸Œè¡¨

å½“ä½ æƒ³å¿«é€ŸæŸ¥æ‰¾å€¼æ—¶ï¼Œå“ˆå¸Œè¡¨æ˜¯éžå¸¸æœ‰ç”¨çš„ã€‚è€Œä¸”ï¼Œç†è§£å“ˆå¸Œè¡¨ä¼šå¸®åŠ©æˆ‘ä»¬æŽ¥ä¸‹æ¥ç†è§£ä¸€ä¸ªæ•°æ®åº“å¸¸è§çš„è”æŽ¥æ“ä½œï¼Œå«åšã€Žå“ˆå¸Œè”æŽ¥ã€ã€‚è¿™ä¸ª**æ•°æ®ç»“æž„ä¹Ÿè¢«æ•°æ®åº“ç”¨æ¥ä¿å­˜ä¸€äº›å†…éƒ¨çš„ä¸œè¥¿**ï¼ˆæ¯”å¦‚**é”è¡¨**æˆ–è€…**ç¼“å†²æ± **ï¼Œæˆ‘ä»¬åœ¨ä¸‹æ–‡ä¼šç ”ç©¶è¿™ä¸¤ä¸ªæ¦‚å¿µï¼‰



**ä¸ºä»€ä¹ˆä¸ç”¨é˜µåˆ—å‘¢**ï¼Ÿ

- å¦‚æžœæœ‰äº†å¥½çš„å“ˆå¸Œå‡½æ•°ï¼Œåœ¨å“ˆå¸Œè¡¨é‡Œæœç´¢çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚
- **ä¸€ä¸ªå“ˆå¸Œè¡¨å¯ä»¥åªè£…è½½ä¸€åŠåˆ°å†…å­˜ï¼Œå‰©ä¸‹çš„å“ˆå¸Œæ¡¶å¯ä»¥ç•™åœ¨ç¡¬ç›˜ä¸Š**ã€‚
- ç”¨é˜µåˆ—çš„è¯ï¼Œä½ éœ€è¦ä¸€ä¸ªè¿žç»­å†…å­˜ç©ºé—´ã€‚å¦‚æžœä½ åŠ è½½ä¸€ä¸ªå¤§è¡¨ï¼Œå¾ˆéš¾åˆ†é…è¶³å¤Ÿçš„è¿žç»­å†…å­˜ç©ºé—´ã€‚



## å…¨å±€æ¦‚è§ˆ

å·²ç»äº†è§£äº†**æ•°æ®åº“å†…éƒ¨çš„éƒ¨åˆ†é‡è¦ç®—æ³•**ï¼ŒçŽ°åœ¨éœ€è¦å›žæ¥çœ‹çœ‹**æ•°æ®åº“çš„å…¨è²Œ**äº†ã€‚

æ•°æ®åº“ä¸€èˆ¬å¯ä»¥ç”¨å¦‚ä¸‹å›¾å½¢æ¥ç†è§£ï¼š

![sb-sql-learn-2](Images/sb-sql-learn-2.png)

### æ ¸å¿ƒç»„ä»¶

- **è¿›ç¨‹ç®¡ç†å™¨ï¼ˆprocess managerï¼‰**ï¼šå¾ˆå¤šæ•°æ®åº“å…·å¤‡ä¸€ä¸ªéœ€è¦å¦¥å–„ç®¡ç†çš„è¿›ç¨‹/çº¿ç¨‹æ± ã€‚å†è€…ï¼Œä¸ºäº†å®žçŽ°çº³ç§’çº§æ“ä½œï¼Œä¸€äº›çŽ°ä»£æ•°æ®åº“ä½¿ç”¨è‡ªå·±çš„çº¿ç¨‹è€Œä¸æ˜¯æ“ä½œç³»ç»Ÿçº¿ç¨‹ã€‚
- **ç½‘ç»œç®¡ç†å™¨ï¼ˆnetwork managerï¼‰**ï¼šç½‘è·¯I/Oæ˜¯ä¸ªå¤§é—®é¢˜ï¼Œå°¤å…¶æ˜¯å¯¹äºŽåˆ†å¸ƒå¼æ•°æ®åº“ã€‚æ‰€ä»¥ä¸€äº›æ•°æ®åº“å…·å¤‡è‡ªå·±çš„ç½‘ç»œç®¡ç†å™¨ã€‚
- **æ–‡ä»¶ç³»ç»Ÿç®¡ç†å™¨ï¼ˆFile system managerï¼‰**ï¼šç£ç›˜I/Oæ˜¯æ•°æ®åº“çš„é¦–è¦ç“¶é¢ˆã€‚å…·å¤‡ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿç®¡ç†å™¨æ¥å®Œç¾Žåœ°å¤„ç†OSæ–‡ä»¶ç³»ç»Ÿç”šè‡³å–ä»£OSæ–‡ä»¶ç³»ç»Ÿï¼Œæ˜¯éžå¸¸é‡è¦çš„ã€‚
- **å†…å­˜ç®¡ç†å™¨ï¼ˆmemory managerï¼‰**ï¼šä¸ºäº†é¿å…ç£ç›˜I/Oå¸¦æ¥çš„æ€§èƒ½æŸå¤±ï¼Œéœ€è¦å¤§é‡çš„å†…å­˜ã€‚ä½†æ˜¯å¦‚æžœä½ è¦å¤„ç†å¤§å®¹é‡å†…å­˜ä½ éœ€è¦é«˜æ•ˆçš„å†…å­˜ç®¡ç†å™¨ï¼Œå°¤å…¶æ˜¯ä½ æœ‰å¾ˆå¤šæŸ¥è¯¢åŒæ—¶ä½¿ç”¨å†…å­˜çš„æ—¶å€™ã€‚
- **å®‰å…¨ç®¡ç†å™¨ï¼ˆSecurity Managerï¼‰**ï¼šç”¨äºŽå¯¹ç”¨æˆ·çš„éªŒè¯å’ŒæŽˆæƒã€‚
- **å®¢æˆ·ç«¯ç®¡ç†å™¨ï¼ˆClient managerï¼‰**ï¼šç”¨äºŽç®¡ç†å®¢æˆ·ç«¯è¿žæŽ¥ã€‚
- ......



### å·¥å…·

- **å¤‡ä»½ç®¡ç†å™¨ï¼ˆBackup managerï¼‰**ï¼šç”¨äºŽä¿å­˜å’Œæ¢å¤æ•°æ®ã€‚
- **æ¢å¤ç®¡ç†å™¨ï¼ˆRecovery manager**ï¼‰ï¼šç”¨äºŽå´©æºƒåŽé‡å¯æ•°æ®åº“åˆ°ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚
- **ç›‘æŽ§ç®¡ç†å™¨ï¼ˆMonitor managerï¼‰**ï¼šç”¨äºŽè®°å½•æ•°æ®åº“æ´»åŠ¨ä¿¡æ¯å’Œæä¾›ç›‘æŽ§æ•°æ®åº“çš„å·¥å…·ã€‚
- **ç®¡ç†å‘˜ç®¡ç†å™¨ï¼ˆAdministration managerï¼‰**ï¼šç”¨äºŽä¿å­˜å…ƒæ•°æ®ï¼ˆæ¯”å¦‚è¡¨çš„åç§°å’Œç»“æž„ï¼‰ï¼Œæä¾›ç®¡ç†æ•°æ®åº“ã€æ¨¡å¼ã€è¡¨ç©ºé—´çš„å·¥å…·ã€‚
- .......



### æŸ¥è¯¢ç®¡ç†å™¨

- **æŸ¥è¯¢è§£æžå™¨ï¼ˆQuery parserï¼‰**ï¼šç”¨äºŽæ£€æŸ¥æŸ¥è¯¢æ˜¯å¦åˆæ³•
- **æŸ¥è¯¢é‡å†™å™¨ï¼ˆQuery rewriterï¼‰**ï¼šç”¨äºŽé¢„ä¼˜åŒ–æŸ¥è¯¢
- **æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼ˆQuery optimizerï¼‰**ï¼šç”¨äºŽä¼˜åŒ–æŸ¥è¯¢
- **æŸ¥è¯¢æ‰§è¡Œå™¨ï¼ˆQuery executorï¼‰**ï¼šç”¨äºŽç¼–è¯‘å’Œæ‰§è¡ŒæŸ¥è¯¢



### æ•°æ®ç®¡ç†å™¨ï¼š

- **äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTransaction managerï¼‰**ï¼šç”¨äºŽå¤„ç†äº‹åŠ¡
- **ç¼“å­˜ç®¡ç†å™¨ï¼ˆCache managerï¼‰**ï¼šæ•°æ®è¢«ä½¿ç”¨ä¹‹å‰ç½®äºŽå†…å­˜ï¼Œæˆ–è€…æ•°æ®å†™å…¥ç£ç›˜ä¹‹å‰ç½®äºŽå†…å­˜
- **æ•°æ®è®¿é—®ç®¡ç†å™¨ï¼ˆData access managerï¼‰**ï¼šè®¿é—®ç£ç›˜ä¸­çš„æ•°æ®



## æ•°æ®æŸ¥è¯¢çš„æµç¨‹

é›†ä¸­æŽ¢è®¨æ•°æ®åº“å¦‚ä½•é€šè¿‡å¦‚ä¸‹è¿›ç¨‹ç®¡ç†SQLæŸ¥è¯¢çš„ï¼š

- å®¢æˆ·ç«¯ç®¡ç†å™¨
- æŸ¥è¯¢ç®¡ç†å™¨
- æ•°æ®ç®¡ç†å™¨ï¼ˆå«æ¢å¤ç®¡ç†å™¨ï¼‰
- å®¢æˆ·ç«¯ç®¡ç†å™¨



## å®¢æˆ·ç«¯ç®¡ç†å™¨

å®¢æˆ·ç«¯ç®¡ç†å™¨æ˜¯å¤„ç†å®¢æˆ·ç«¯é€šä¿¡çš„ã€‚å®¢æˆ·ç«¯å¯ä»¥æ˜¯ä¸€ä¸ªï¼ˆç½‘ç«™ï¼‰æœåŠ¡å™¨æˆ–è€…ä¸€ä¸ªæœ€ç»ˆç”¨æˆ·æˆ–æœ€ç»ˆåº”ç”¨ã€‚å®¢æˆ·ç«¯ç®¡ç†å™¨é€šè¿‡ä¸€ç³»åˆ—çŸ¥åçš„APIï¼ˆJDBC, ODBC, OLE-DB â€¦ï¼‰æä¾›ä¸åŒçš„æ–¹å¼æ¥è®¿é—®æ•°æ®åº“ã€‚å®¢æˆ·ç«¯ç®¡ç†å™¨ä¹Ÿæä¾›ä¸“æœ‰çš„æ•°æ®åº“è®¿é—®APIã€‚

![sb-sql-learn-4](Images/sb-sql-learn-4.png)



**å½“è¿žæŽ¥åˆ°æ•°æ®åº“æ—¶**ï¼š

- ç®¡ç†å™¨é¦–å…ˆæ£€æŸ¥ä½ çš„éªŒè¯ä¿¡æ¯ï¼ˆç”¨æˆ·åå’Œå¯†ç ï¼‰ï¼Œç„¶åŽæ£€æŸ¥ä½ æ˜¯å¦æœ‰è®¿é—®æ•°æ®åº“çš„æŽˆæƒã€‚è¿™äº›æƒé™ç”±DBAåˆ†é…ã€‚
- ç„¶åŽï¼Œç®¡ç†å™¨æ£€æŸ¥æ˜¯å¦æœ‰ç©ºé—²è¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰æ¥å¤„ç†ä½ å¯¹æŸ¥è¯¢ã€‚
- ç®¡ç†å™¨è¿˜ä¼šæ£€æŸ¥æ•°æ®åº“æ˜¯å¦è´Ÿè½½å¾ˆé‡ã€‚
- ç®¡ç†å™¨å¯èƒ½ä¼šç­‰å¾…ä¸€ä¼šå„¿æ¥èŽ·å–éœ€è¦çš„èµ„æºã€‚å¦‚æžœç­‰å¾…æ—¶é—´è¾¾åˆ°è¶…æ—¶æ—¶é—´ï¼Œå®ƒä¼šå…³é—­è¿žæŽ¥å¹¶ç»™å‡ºä¸€ä¸ªå¯è¯»çš„é”™è¯¯ä¿¡æ¯ã€‚
- ç„¶åŽç®¡ç†å™¨ä¼šæŠŠä½ çš„æŸ¥è¯¢é€ç»™æŸ¥è¯¢ç®¡ç†å™¨æ¥å¤„ç†ã€‚
- å› ä¸ºæŸ¥è¯¢å¤„ç†è¿›ç¨‹ä¸æ˜¯ã€Žä¸å…¨åˆ™æ— ã€çš„ï¼Œä¸€æ—¦å®ƒä»ŽæŸ¥è¯¢ç®¡ç†å™¨å¾—åˆ°æ•°æ®ï¼Œå®ƒä¼šæŠŠéƒ¨åˆ†ç»“æžœä¿å­˜åˆ°ä¸€ä¸ªç¼“å†²åŒºå¹¶ä¸”å¼€å§‹ç»™ä½ å‘é€ã€‚
- å¦‚æžœé‡åˆ°é—®é¢˜ï¼Œç®¡ç†å™¨å…³é—­è¿žæŽ¥ï¼Œå‘ä½ å‘é€å¯è¯»çš„è§£é‡Šä¿¡æ¯ï¼Œç„¶åŽé‡Šæ”¾èµ„æºã€‚



## æŸ¥è¯¢ç®¡ç†å™¨

è¿™éƒ¨åˆ†æ˜¯æ•°æ®åº“çš„å¨åŠ›æ‰€åœ¨ï¼Œåœ¨è¿™éƒ¨åˆ†é‡Œï¼Œä¸€ä¸ªå†™å¾—ç³Ÿç³•çš„æŸ¥è¯¢å¯ä»¥è½¬æ¢æˆä¸€ä¸ªå¿«é€Ÿæ‰§è¡Œçš„ä»£ç ï¼Œä»£ç æ‰§è¡Œçš„ç»“æžœè¢«é€åˆ°å®¢æˆ·ç«¯ç®¡ç†å™¨ã€‚

![sb-sql-learn-3](Images/sb-sql-learn-3.png)

è¿™ä¸ªå¤šæ­¥éª¤æ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š

- æŸ¥è¯¢é¦–å…ˆè¢«**è§£æž**å¹¶åˆ¤æ–­æ˜¯å¦åˆæ³•
- ç„¶åŽè¢«**é‡å†™**ï¼ŒåŽ»é™¤äº†æ— ç”¨çš„æ“ä½œå¹¶ä¸”åŠ å…¥**é¢„ä¼˜åŒ–**éƒ¨åˆ†
- æŽ¥ç€è¢«**ä¼˜åŒ–**ä»¥ä¾¿æå‡æ€§èƒ½ï¼Œå¹¶è¢«**è½¬æ¢ä¸ºå¯æ‰§è¡Œä»£ç **å’Œ**æ•°æ®è®¿é—®è®¡åˆ’**ã€‚
- ç„¶åŽè®¡åˆ’è¢«**ç¼–è¯‘**
- æœ€åŽï¼Œè¢«**æ‰§è¡Œ**



### æŸ¥è¯¢è§£æžå™¨

æ¯ä¸€æ¡SQLè¯­å¥éƒ½è¦é€åˆ°è§£æžå™¨æ¥æ£€æŸ¥è¯­æ³•ï¼Œå¦‚æžœä½ çš„æŸ¥è¯¢æœ‰é”™ï¼Œè§£æžå™¨å°†æ‹’ç»è¯¥æŸ¥è¯¢ã€‚æ¯”å¦‚ï¼Œå¦‚æžœä½ å†™æˆâ€SLECT â€¦â€ è€Œä¸æ˜¯ â€œSELECT â€¦â€ï¼Œé‚£å°±æ²¡æœ‰ä¸‹æ–‡äº†ã€‚



ä½†è¿™è¿˜ä¸ç®—å®Œï¼Œè§£æžå™¨è¿˜ä¼šæ£€æŸ¥å…³é”®å­—æ˜¯å¦ä½¿ç”¨æ­£ç¡®çš„é¡ºåºï¼Œæ¯”å¦‚ WHERE å†™åœ¨ SELECT ä¹‹å‰ä¼šè¢«æ‹’ç»ã€‚

ç„¶åŽï¼Œè§£æžå™¨è¦åˆ†æžæŸ¥è¯¢ä¸­çš„è¡¨å’Œå­—æ®µï¼Œä½¿ç”¨æ•°æ®åº“å…ƒæ•°æ®æ¥æ£€æŸ¥ï¼š

- è¡¨æ˜¯å¦å­˜åœ¨
- è¡¨çš„å­—æ®µæ˜¯å¦å­˜åœ¨
- å¯¹æŸç±»åž‹å­—æ®µçš„ è¿ç®— æ˜¯å¦ å¯èƒ½ï¼ˆæ¯”å¦‚ï¼Œä½ ä¸èƒ½å°†æ•´æ•°å’Œå­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œä½ ä¸èƒ½å¯¹ä¸€ä¸ªæ•´æ•°ä½¿ç”¨ substring() å‡½æ•°ï¼‰

æŽ¥ç€ï¼Œè§£æžå™¨æ£€æŸ¥åœ¨æŸ¥è¯¢ä¸­ä½ æ˜¯å¦æœ‰æƒé™æ¥è¯»å–ï¼ˆæˆ–å†™å…¥ï¼‰è¡¨ã€‚å†å¼ºè°ƒä¸€æ¬¡ï¼šè¿™äº›æƒé™ç”±DBAåˆ†é…ã€‚

åœ¨è§£æžè¿‡ç¨‹ä¸­ï¼ŒSQL æŸ¥è¯¢è¢«è½¬æ¢ä¸ºå†…éƒ¨è¡¨ç¤ºï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªæ ‘ï¼‰ã€‚

å¦‚æžœä¸€åˆ‡æ­£å¸¸ï¼Œå†…éƒ¨è¡¨ç¤ºè¢«é€åˆ°æŸ¥è¯¢é‡å†™å™¨ã€‚



### æŸ¥è¯¢é‡å†™å™¨

åœ¨è¿™ä¸€æ­¥ï¼Œå·²ç»æœ‰äº†æŸ¥è¯¢çš„å†…éƒ¨è¡¨ç¤ºï¼Œé‡å†™å™¨çš„ç›®æ ‡æ˜¯ï¼š

- é¢„ä¼˜åŒ–æŸ¥è¯¢

- é¿å…ä¸å¿…è¦çš„è¿ç®—

- å¸®åŠ©ä¼˜åŒ–å™¨æ‰¾åˆ°åˆç†çš„æœ€ä½³è§£å†³æ–¹æ¡ˆ

  

é‡å†™å™¨æŒ‰ç…§ä¸€ç³»åˆ—å·²çŸ¥çš„è§„åˆ™å¯¹æŸ¥è¯¢æ‰§è¡Œæ£€æµ‹ã€‚å¦‚æžœæŸ¥è¯¢åŒ¹é…ä¸€ç§æ¨¡å¼çš„è§„åˆ™ï¼ŒæŸ¥è¯¢å°±ä¼šæŒ‰ç…§è¿™æ¡è§„åˆ™æ¥é‡å†™ã€‚ä¸‹é¢æ˜¯ï¼ˆå¯é€‰ï¼‰è§„åˆ™çš„éžè¯¦å°½çš„åˆ—è¡¨ï¼š

- **è§†å›¾åˆå¹¶**ï¼šå¦‚æžœä½ åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨è§†å›¾ï¼Œè§†å›¾å°±ä¼šè½¬æ¢ä¸ºå®ƒçš„ SQL ä»£ç ã€‚

- å­æŸ¥è¯¢æ‰å¹³åŒ–

  ï¼šå­æŸ¥è¯¢æ˜¯å¾ˆéš¾ä¼˜åŒ–çš„ï¼Œå› æ­¤é‡å†™å™¨ä¼šå°è¯•ç§»é™¤å­æŸ¥è¯¢

  - ä¾‹å¦‚ï¼š

  ```sql
  SELECT PERSON.*
  FROM PERSON
  WHERE PERSON.person_key IN
  (SELECT MAILS.person_key
  FROM MAILS
  WHERE MAILS.mail LIKE 'christophe%');
  ```

ä¼šè½¬æ¢ä¸ºï¼š

```sql
SELECT PERSON.*
FROM PERSON, MAILS
WHERE PERSON.person_key = MAILS.person_key
and MAILS.mail LIKE 'christophe%';
```

* **åŽ»é™¤ä¸å¿…è¦çš„è¿ç®—ç¬¦**ï¼šæ¯”å¦‚ï¼Œå¦‚æžœä½ ç”¨äº† DISTINCTï¼Œè€Œå…¶å®žä½ æœ‰ UNIQUE çº¦æŸï¼ˆè¿™æœ¬èº«å°±é˜²æ­¢äº†æ•°æ®å‡ºçŽ°é‡å¤ï¼‰ï¼Œé‚£ä¹ˆ DISTINCT å…³é”®å­—å°±è¢«åŽ»æŽ‰äº†ã€‚



* **æŽ’é™¤å†—ä½™çš„è”æŽ¥**ï¼šå¦‚æžœç›¸åŒçš„ JOIN æ¡ä»¶å‡ºçŽ°ä¸¤æ¬¡ï¼Œæ¯”å¦‚éšè—åœ¨è§†å›¾ä¸­çš„ JOIN æ¡ä»¶ï¼Œæˆ–è€…ç”±äºŽä¼ é€’æ€§äº§ç”Ÿçš„æ— ç”¨ JOINï¼Œéƒ½ä¼šè¢«æ¶ˆé™¤ã€‚



* **å¸¸æ•°è®¡ç®—èµ‹å€¼**ï¼šå¦‚æžœä½ çš„æŸ¥è¯¢éœ€è¦è®¡ç®—ï¼Œé‚£ä¹ˆåœ¨é‡å†™è¿‡ç¨‹ä¸­è®¡ç®—ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚æ¯”å¦‚ WHERE AGE > 10+2 ä¼šè½¬æ¢ä¸º WHERE AGE > 12 ï¼Œ TODATE(â€œæ—¥æœŸå­—ç¬¦ä¸²â€) ä¼šè½¬æ¢ä¸º datetime æ ¼å¼çš„æ—¥æœŸå€¼ã€‚



* **ï¼ˆé«˜çº§ï¼‰åˆ†åŒºè£å‰ªï¼ˆPartition Pruningï¼‰**ï¼šå¦‚æžœä½ ç”¨äº†åˆ†åŒºè¡¨ï¼Œé‡å†™å™¨èƒ½å¤Ÿæ‰¾åˆ°éœ€è¦ä½¿ç”¨çš„åˆ†åŒºã€‚



* **ï¼ˆé«˜çº§ï¼‰ç‰©åŒ–è§†å›¾é‡å†™ï¼ˆMaterialized view rewriteï¼‰**ï¼šå¦‚æžœä½ æœ‰ä¸ªç‰©åŒ–è§†å›¾åŒ¹é…æŸ¥è¯¢è°“è¯çš„ä¸€ä¸ªå­é›†ï¼Œé‡å†™å™¨å°†æ£€æŸ¥è§†å›¾æ˜¯å¦æœ€æ–°å¹¶ä¿®æ”¹æŸ¥è¯¢ï¼Œä»¤æŸ¥è¯¢ä½¿ç”¨ç‰©åŒ–è§†å›¾è€Œä¸æ˜¯åŽŸå§‹è¡¨ã€‚



* **ï¼ˆé«˜çº§ï¼‰è‡ªå®šä¹‰è§„åˆ™**ï¼šå¦‚æžœä½ æœ‰è‡ªå®šä¹‰è§„åˆ™æ¥ä¿®æ”¹æŸ¥è¯¢ï¼ˆå°±åƒ Oracle policyï¼‰ï¼Œé‡å†™å™¨å°±ä¼šæ‰§è¡Œè¿™äº›è§„åˆ™ã€‚



* **ï¼ˆé«˜çº§ï¼‰OLAPè½¬æ¢**ï¼šåˆ†æž/åŠ çª— å‡½æ•°ï¼Œæ˜Ÿå½¢è”æŽ¥ï¼ŒROLLUP å‡½æ•°â€¦â€¦éƒ½ä¼šå‘ç”Ÿè½¬æ¢ï¼ˆä½†æˆ‘ä¸ç¡®å®šè¿™æ˜¯ç”±é‡å†™å™¨è¿˜æ˜¯ä¼˜åŒ–å™¨æ¥å®Œæˆï¼Œå› ä¸ºä¸¤ä¸ªè¿›ç¨‹è”ç³»å¾ˆç´§ï¼Œå¿…é¡»çœ‹æ˜¯ä»€ä¹ˆæ•°æ®åº“ï¼‰ã€‚





### ç»Ÿè®¡

ç ”ç©¶æ•°æ®åº“å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢ä¹‹å‰æˆ‘ä»¬éœ€è¦è°ˆè°ˆç»Ÿè®¡ï¼Œå› ä¸º**æ²¡æœ‰ç»Ÿè®¡çš„æ•°æ®åº“æ˜¯æ„šè ¢çš„**ã€‚é™¤éžä½ æ˜Žç¡®æŒ‡ç¤ºï¼Œæ•°æ®åº“æ˜¯ä¸ä¼šåˆ†æžè‡ªå·±çš„æ•°æ®çš„ã€‚æ²¡æœ‰åˆ†æžä¼šå¯¼è‡´æ•°æ®åº“åšå‡ºï¼ˆéžå¸¸ï¼‰ç³Ÿç³•çš„å‡è®¾ã€‚



ä½†æ˜¯ï¼Œæ•°æ®åº“éœ€è¦ä»€ä¹ˆç±»åž‹çš„ä¿¡æ¯å‘¢ï¼Ÿ

æˆ‘å¿…é¡»ï¼ˆç®€è¦åœ°ï¼‰è°ˆè°ˆæ•°æ®åº“å’Œæ“ä½œç³»ç»Ÿå¦‚ä½•ä¿å­˜æ•°æ®ã€‚ä¸¤è€…ä½¿ç”¨çš„æœ€å°å•ä½å«åšé¡µæˆ–å—ï¼ˆé»˜è®¤ 4 æˆ– 8 KBï¼‰ã€‚è¿™å°±æ˜¯è¯´å¦‚æžœä½ ä»…éœ€è¦ 1KBï¼Œä¹Ÿä¼šå ç”¨ä¸€ä¸ªé¡µã€‚è¦æ˜¯é¡µçš„å¤§å°ä¸º 8KBï¼Œä½ å°±æµªè´¹äº† 7KBã€‚

å›žæ¥ç»§ç»­è®²ç»Ÿè®¡ï¼ å½“ä½ è¦æ±‚æ•°æ®åº“æ”¶é›†ç»Ÿè®¡ä¿¡æ¯ï¼Œæ•°æ®åº“ä¼šè®¡ç®—ä¸‹åˆ—å€¼ï¼š

- è¡¨ä¸­è¡Œå’Œé¡µçš„æ•°é‡
- è¡¨ä¸­æ¯ä¸ªåˆ—ä¸­çš„ï¼š
  - å”¯ä¸€å€¼
  - æ•°æ®é•¿åº¦ï¼ˆæœ€å°ï¼Œæœ€å¤§ï¼Œå¹³å‡ï¼‰
  - æ•°æ®èŒƒå›´ï¼ˆæœ€å°ï¼Œæœ€å¤§ï¼Œå¹³å‡ï¼‰
- è¡¨çš„ç´¢å¼•ä¿¡æ¯

**è¿™äº›ç»Ÿè®¡ä¿¡æ¯ä¼šå¸®åŠ©ä¼˜åŒ–å™¨ä¼°è®¡æŸ¥è¯¢æ‰€éœ€çš„ç£ç›˜ I/Oã€CPUã€å’Œå†…å­˜ä½¿ç”¨**

å¯¹æ¯ä¸ªåˆ—çš„ç»Ÿè®¡éžå¸¸é‡è¦ã€‚æ¯”å¦‚ï¼Œå¦‚æžœä¸€ä¸ªè¡¨ PERSON éœ€è¦è”æŽ¥ 2 ä¸ªåˆ—ï¼š LAST_NAME, FIRST_NAMEã€‚æ ¹æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œæ•°æ®åº“çŸ¥é“FIRST_NAMEåªæœ‰ 1,000 ä¸ªä¸åŒçš„å€¼ï¼ŒLAST_NAME æœ‰ 1,000,000 ä¸ªä¸åŒçš„å€¼ã€‚å› æ­¤ï¼Œæ•°æ®åº“å°±ä¼šæŒ‰ç…§ LAST_NAME, FIRST_NAME è”æŽ¥ã€‚å› ä¸º LAST_NAME ä¸å¤§å¯èƒ½é‡å¤ï¼Œå¤šæ•°æƒ…å†µä¸‹æ¯”è¾ƒ LAST_NAME çš„å¤´ 2 ã€ 3 ä¸ªå­—ç¬¦å°±å¤Ÿäº†ï¼Œè¿™å°†å¤§å¤§å‡å°‘æ¯”è¾ƒçš„æ¬¡æ•°ã€‚

ä¸è¿‡ï¼Œè¿™äº›åªæ˜¯åŸºæœ¬çš„ç»Ÿè®¡ã€‚ä½ å¯ä»¥è®©æ•°æ®åº“åšä¸€ç§é«˜çº§ç»Ÿè®¡ï¼Œå«ç›´æ–¹å›¾ã€‚ç›´æ–¹å›¾æ˜¯åˆ—å€¼åˆ†å¸ƒæƒ…å†µçš„ç»Ÿè®¡ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š

- å‡ºçŽ°æœ€é¢‘ç¹çš„å€¼
- åˆ†ä½æ•°(quantiles)
- â€¦

è¿™äº›é¢å¤–çš„ç»Ÿè®¡ä¼šå¸®åŠ©æ•°æ®åº“æ‰¾åˆ°æ›´ä½³çš„æŸ¥è¯¢è®¡åˆ’ï¼Œå°¤å…¶æ˜¯å¯¹äºŽç­‰å¼è°“è¯ï¼ˆä¾‹å¦‚ï¼š WHERE AGE = 18 ï¼‰æˆ–èŒƒå›´è°“è¯ï¼ˆä¾‹å¦‚ï¼š WHERE AGE > 10 and AGE < 40ï¼‰ï¼Œå› ä¸ºæ•°æ®åº“å¯ä»¥æ›´å¥½çš„äº†è§£è¿™äº›è°“è¯ç›¸å…³çš„æ•°å­—ç±»åž‹æ•°æ®è¡Œï¼ˆæ³¨ï¼šè¿™ä¸ªæ¦‚å¿µçš„æŠ€æœ¯åç§°å«é€‰æ‹©çŽ‡ï¼‰ã€‚

ç»Ÿè®¡ä¿¡æ¯ä¿å­˜åœ¨æ•°æ®åº“å…ƒæ•°æ®å†…ï¼Œä¾‹å¦‚ï¼ˆéžåˆ†åŒºï¼‰è¡¨çš„ç»Ÿè®¡ä¿¡æ¯ä½ç½®ï¼š

- Oracleï¼š USER / ALL / DBA_TABLES å’Œ USER / ALL / DBA_TAB_COLUMNS
- DB2ï¼š SYSCAT.TABLES å’Œ SYSCAT.COLUMNS



**ç»Ÿè®¡ä¿¡æ¯å¿…é¡»åŠæ—¶æ›´æ–°**ã€‚å¦‚æžœä¸€ä¸ªè¡¨æœ‰ 1,000,000 è¡Œè€Œæ•°æ®åº“è®¤ä¸ºå®ƒåªæœ‰ 500 è¡Œï¼Œæ²¡æœ‰æ¯”è¿™æ›´ç³Ÿç³•çš„äº†ã€‚ç»Ÿè®¡å”¯ä¸€çš„ä¸åˆ©ä¹‹å¤„æ˜¯éœ€è¦æ—¶é—´æ¥è®¡ç®—ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ•°æ®åº“å¤§å¤šé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šè‡ªåŠ¨è®¡ç®—ç»Ÿè®¡ä¿¡æ¯ã€‚æ•°æ®è¾¾åˆ°ç™¾ä¸‡çº§æ—¶ç»Ÿè®¡ä¼šå˜å¾—å›°éš¾ï¼Œè¿™æ—¶å€™ï¼Œä½ å¯ä»¥é€‰æ‹©ä»…åšåŸºæœ¬ç»Ÿè®¡æˆ–è€…åœ¨ä¸€ä¸ªæ•°æ®åº“æ ·æœ¬ä¸Šæ‰§è¡Œç»Ÿè®¡ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘å‚ä¸Žçš„ä¸€ä¸ªé¡¹ç›®éœ€è¦å¤„ç†æ¯è¡¨ä¸Šäº¿æ¡æ•°æ®çš„åº“ï¼Œæˆ‘é€‰æ‹©åªç»Ÿè®¡10%ï¼Œç»“æžœé€ æˆäº†å·¨å¤§çš„æ—¶é—´æ¶ˆè€—ã€‚æœ¬ä¾‹è¯æ˜Žè¿™æ˜¯ä¸ªç³Ÿç³•çš„å†³å®šï¼Œå› ä¸ºæœ‰æ—¶å€™ Oracle 10G ä»Žç‰¹å®šè¡¨çš„ç‰¹å®šåˆ—ä¸­é€‰å‡ºçš„ 10% è·Ÿå…¨éƒ¨ 100% æœ‰å¾ˆå¤§ä¸åŒï¼ˆå¯¹äºŽæ‹¥æœ‰ä¸€äº¿è¡Œæ•°æ®çš„è¡¨ï¼Œè¿™ç§æƒ…å†µæžå°‘å‘ç”Ÿï¼‰ã€‚è¿™æ¬¡é”™è¯¯çš„ç»Ÿè®¡å¯¼è‡´äº†ä¸€ä¸ªæœ¬åº” 30 ç§’å®Œæˆçš„æŸ¥è¯¢æœ€åŽæ‰§è¡Œäº† 8 ä¸ªå°æ—¶ï¼ŒæŸ¥æ‰¾è¿™ä¸ªçŽ°è±¡æ ¹æºçš„è¿‡ç¨‹ç®€ç›´æ˜¯ä¸ªå™©æ¢¦ã€‚è¿™ä¸ªä¾‹å­æ˜¾ç¤ºäº†ç»Ÿè®¡çš„é‡è¦æ€§ã€‚

### æŸ¥è¯¢ä¼˜åŒ–å™¨

æ‰€æœ‰çš„çŽ°ä»£æ•°æ®åº“éƒ½åœ¨ç”¨**åŸºäºŽæˆæœ¬çš„ä¼˜åŒ–**ï¼ˆå³CBOï¼‰æ¥ä¼˜åŒ–æŸ¥è¯¢ã€‚é“ç†æ˜¯é’ˆå¯¹æ¯ä¸ªè¿ç®—è®¾ç½®ä¸€ä¸ªæˆæœ¬ï¼Œé€šè¿‡åº”ç”¨æˆæœ¬æœ€ä½Žå»‰çš„ä¸€ç³»åˆ—è¿ç®—ï¼Œæ¥æ‰¾åˆ°æœ€ä½³çš„é™ä½ŽæŸ¥è¯¢æˆæœ¬çš„æ–¹æ³•ã€‚



ä¸ºäº†ç†è§£æˆæœ¬ä¼˜åŒ–å™¨çš„åŽŸç†ï¼Œæˆ‘è§‰å¾—æœ€å¥½ç”¨ä¸ªä¾‹å­æ¥ã€Žæ„Ÿå—ã€ä¸€ä¸‹è¿™ä¸ªä»»åŠ¡èƒŒåŽçš„å¤æ‚æ€§ã€‚è¿™é‡Œæˆ‘å°†ç»™å‡ºè”æŽ¥ 2 ä¸ªè¡¨çš„ 3 ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±èƒ½çœ‹åˆ°å³ä¾¿ä¸€ä¸ªç®€å•çš„è”æŽ¥æŸ¥è¯¢å¯¹äºŽä¼˜åŒ–å™¨æ¥è¯´éƒ½æ˜¯ä¸ªå™©æ¢¦ã€‚ä¹‹åŽï¼Œæˆ‘ä»¬ä¼šäº†è§£çœŸæ­£çš„ä¼˜åŒ–å™¨æ˜¯æ€Žä¹ˆåšçš„ã€‚



**å¯¹äºŽè¿™äº›è”æŽ¥æ“ä½œï¼Œæˆ‘ä¼šä¸“æ³¨äºŽå®ƒä»¬çš„æ—¶é—´å¤æ‚åº¦ï¼Œä½†æ˜¯ï¼Œæ•°æ®åº“ä¼˜åŒ–å™¨è®¡ç®—çš„æ˜¯å®ƒä»¬çš„ CPU æˆæœ¬ã€ç£ç›˜ I/O æˆæœ¬ã€å’Œå†…å­˜éœ€æ±‚**ã€‚æ—¶é—´å¤æ‚åº¦å’Œ CPU æˆæœ¬çš„åŒºåˆ«æ˜¯ï¼Œæ—¶é—´æˆæœ¬æ˜¯ä¸ªè¿‘ä¼¼å€¼ï¼ˆç»™æˆ‘è¿™æ ·çš„æ‡’å®¶ä¼™å‡†å¤‡çš„ï¼‰ã€‚è€Œ CPU æˆæœ¬ï¼Œæˆ‘è¿™é‡ŒåŒ…æ‹¬äº†æ‰€æœ‰çš„è¿ç®—ï¼Œæ¯”å¦‚ï¼šåŠ æ³•ã€æ¡ä»¶åˆ¤æ–­ã€ä¹˜æ³•ã€è¿­ä»£â€¦â€¦è¿˜æœ‰å‘¢ï¼š



æ¯ä¸€ä¸ªé«˜çº§ä»£ç è¿ç®—éƒ½è¦ç‰¹å®šæ•°é‡çš„ä½Žçº§ CPU è¿ç®—ã€‚

å¯¹äºŽ Intel Core i7ã€Intel Pentium 4ã€AMD Opteronâ€¦ç­‰ï¼Œï¼ˆå°± CPU å‘¨æœŸè€Œè¨€ï¼‰CPU çš„è¿ç®—æˆæœ¬æ˜¯ä¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå–å†³äºŽ CPU çš„æž¶æž„ã€‚



ä½¿ç”¨æ—¶é—´å¤æ‚åº¦å°±å®¹æ˜“å¤šäº†ï¼ˆè‡³å°‘å¯¹æˆ‘æ¥è¯´ï¼‰ï¼Œç”¨å®ƒæˆ‘ä¹Ÿèƒ½äº†è§£åˆ° CBO çš„æ¦‚å¿µã€‚ç”±äºŽç£ç›˜ I/O æ˜¯ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œæˆ‘å¶å°”ä¹Ÿä¼šæåˆ°å®ƒã€‚è¯·ç‰¢è®°ï¼Œ**å¤§å¤šæ•°æ—¶å€™ç“¶é¢ˆåœ¨äºŽç£ç›˜ I/O è€Œä¸æ˜¯ CPU ä½¿ç”¨**ã€‚





#### ç´¢å¼•

åœ¨ç ”ç©¶ B+æ ‘çš„æ—¶å€™æˆ‘ä»¬è°ˆåˆ°äº†ç´¢å¼•ï¼Œè¦è®°ä½ä¸€ç‚¹ï¼Œç´¢å¼•éƒ½æ˜¯å·²ç»æŽ’äº†åºçš„ã€‚



ä»…ä¾›å‚è€ƒï¼šè¿˜æœ‰å…¶ä»–ç±»åž‹çš„ç´¢å¼•ï¼Œæ¯”å¦‚ä½å›¾ç´¢å¼•ï¼Œåœ¨ CPUã€ç£ç›˜I/Oã€å’Œå†…å­˜æ–¹é¢ä¸ŽB+æ ‘ç´¢å¼•çš„æˆæœ¬å¹¶ä¸ç›¸åŒã€‚

å¦å¤–ï¼Œå¾ˆå¤šçŽ°ä»£æ•°æ®åº“ä¸ºäº†æ”¹å–„æ‰§è¡Œè®¡åˆ’çš„æˆæœ¬ï¼Œå¯ä»¥ä»…ä¸ºå½“å‰æŸ¥è¯¢åŠ¨æ€åœ°ç”Ÿæˆä¸´æ—¶ç´¢å¼•ã€‚



#### å­˜å–è·¯å¾„

åœ¨åº”ç”¨è”æŽ¥è¿ç®—ç¬¦ï¼ˆjoin operatorsï¼‰ä¹‹å‰ï¼Œä½ é¦–å…ˆéœ€è¦èŽ·å¾—æ•°æ®ã€‚ä»¥ä¸‹å°±æ˜¯èŽ·å¾—æ•°æ®çš„æ–¹æ³•ã€‚

æ³¨ï¼šç”±äºŽæ‰€æœ‰å­˜å–è·¯å¾„çš„çœŸæ­£é—®é¢˜æ˜¯ç£ç›˜ I/Oï¼Œæˆ‘ä¸ä¼šè¿‡å¤šæŽ¢è®¨æ—¶é—´å¤æ‚åº¦ã€‚

- å…¨æ‰«æ

å¦‚æžœä½ è¯»è¿‡æ‰§è¡Œè®¡åˆ’ï¼Œä¸€å®šçœ‹åˆ°è¿‡ã€Žå…¨æ‰«æã€ï¼ˆæˆ–åªæ˜¯ã€Žæ‰«æã€ï¼‰ä¸€è¯ã€‚ç®€å•çš„è¯´å…¨æ‰«æå°±æ˜¯æ•°æ®åº“å®Œæ•´çš„è¯»ä¸€ä¸ªè¡¨æˆ–ç´¢å¼•ã€‚å°±ç£ç›˜ I/O è€Œè¨€ï¼Œå¾ˆæ˜Žæ˜¾å…¨è¡¨æ‰«æçš„æˆæœ¬æ¯”ç´¢å¼•å…¨æ‰«æè¦é«˜æ˜‚ã€‚

- èŒƒå›´æ‰«æ

å…¶ä»–ç±»åž‹çš„æ‰«ææœ‰ç´¢å¼•èŒƒå›´æ‰«æï¼Œæ¯”å¦‚å½“ä½ ä½¿ç”¨è°“è¯ â€ WHERE AGE > 20 AND AGE < 40 â€ çš„æ—¶å€™å®ƒå°±ä¼šå‘ç”Ÿã€‚

å½“ç„¶ï¼Œä½ éœ€è¦åœ¨ AGE å­—æ®µä¸Šæœ‰ç´¢å¼•æ‰èƒ½ç”¨åˆ°ç´¢å¼•èŒƒå›´æ‰«æã€‚

åœ¨ç¬¬ä¸€éƒ¨åˆ†æˆ‘ä»¬å·²ç»çŸ¥é“ï¼ŒèŒƒå›´æŸ¥è¯¢çš„æ—¶é—´æˆæœ¬å¤§çº¦æ˜¯ log(N)+Mï¼Œè¿™é‡Œ N æ˜¯ç´¢å¼•çš„æ•°æ®é‡ï¼ŒM æ˜¯èŒƒå›´å†…ä¼°æµ‹çš„è¡Œæ•°ã€‚å¤šäºæœ‰äº†ç»Ÿè®¡æˆ‘ä»¬æ‰èƒ½çŸ¥é“ N å’Œ M çš„å€¼ï¼ˆæ³¨ï¼š M æ˜¯è°“è¯ â€œ AGE > 20 AND AGE < 40 â€ çš„é€‰æ‹©çŽ‡ï¼‰ã€‚å¦å¤–èŒƒå›´æ‰«ææ—¶ï¼Œä½ ä¸éœ€è¦è¯»å–æ•´ä¸ªç´¢å¼•ï¼Œå› æ­¤åœ¨ç£ç›˜ I/O æ–¹é¢æ²¡æœ‰å…¨æ‰«æé‚£ä¹ˆæ˜‚è´µã€‚

- å”¯ä¸€æ‰«æ

å¦‚æžœä½ åªéœ€è¦ä»Žç´¢å¼•ä¸­å–ä¸€ä¸ªå€¼ä½ å¯ä»¥ç”¨å”¯ä¸€æ‰«æã€‚

- æ ¹æ® ROW ID å­˜å–

å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æžœæ•°æ®åº“ä½¿ç”¨ç´¢å¼•ï¼Œå®ƒå°±å¿…é¡»æŸ¥æ‰¾ä¸Žç´¢å¼•ç›¸å…³çš„è¡Œï¼Œè¿™æ ·å°±ä¼šç”¨åˆ°æ ¹æ® ROW ID å­˜å–çš„æ–¹å¼ã€‚

ä¾‹å¦‚ï¼Œå‡å¦‚ä½ è¿è¡Œï¼š

```sql
SELECT LASTNAME, FIRSTNAME from PERSON WHERE AGE = 28
```

å¦‚æžœ person è¡¨çš„ age åˆ—æœ‰ç´¢å¼•ï¼Œä¼˜åŒ–å™¨ä¼šä½¿ç”¨ç´¢å¼•æ‰¾åˆ°æ‰€æœ‰å¹´é¾„ä¸º 28 çš„äººï¼Œç„¶åŽå®ƒä¼šåŽ»è¡¨ä¸­è¯»å–ç›¸å…³çš„è¡Œï¼Œè¿™æ˜¯å› ä¸ºç´¢å¼•ä¸­åªæœ‰ age çš„ä¿¡æ¯è€Œä½ è¦çš„æ˜¯å§“å’Œåã€‚

ä½†æ˜¯ï¼Œå‡å¦‚ä½ æ¢ä¸ªåšæ³•ï¼š

```sql
SELECT TYPE_PERSON.CATEGORY from PERSON ,TYPE_PERSON
WHERE PERSON.AGE = TYPE_PERSON.AGE
```

PERSON è¡¨çš„ç´¢å¼•ä¼šç”¨æ¥è”æŽ¥ TYPE_PERSON è¡¨ï¼Œä½†æ˜¯ PERSON è¡¨ä¸ä¼šæ ¹æ®è¡ŒID å­˜å–ï¼Œå› ä¸ºä½ å¹¶æ²¡æœ‰è¦æ±‚è¿™ä¸ªè¡¨å†…çš„ä¿¡æ¯ã€‚

è™½ç„¶è¿™ä¸ªæ–¹æ³•åœ¨å°‘é‡å­˜å–æ—¶è¡¨çŽ°å¾ˆå¥½ï¼Œè¿™ä¸ªè¿ç®—çš„çœŸæ­£é—®é¢˜å…¶å®žæ˜¯ç£ç›˜ I/Oã€‚å‡å¦‚éœ€è¦å¤§é‡çš„æ ¹æ®è¡ŒIDå­˜å–ï¼Œæ•°æ®åº“ä¹Ÿè®¸ä¼šé€‰æ‹©å…¨æ‰«æã€‚

- å…¶å®ƒè·¯å¾„



æˆ‘æ²¡æœ‰åˆ—ä¸¾æ‰€æœ‰çš„å­˜å–è·¯å¾„ï¼Œå¦‚æžœä½ æ„Ÿå…´è¶£å¯ä»¥è¯»ä¸€è¯» Oracleæ–‡æ¡£ã€‚å…¶å®ƒæ•°æ®åº“é‡Œä¹Ÿè®¸å«æ³•ä¸åŒä½†èƒŒåŽçš„æ¦‚å¿µæ˜¯ä¸€æ ·çš„



#### è”æŽ¥è¿ç®—ç¬¦

æˆ‘ä»¬çŸ¥é“å¦‚ä½•èŽ·å–æ•°æ®äº†ï¼Œé‚£çŽ°åœ¨å°±æŠŠå®ƒä»¬è”æŽ¥èµ·æ¥ï¼



æˆ‘è¦å±•çŽ°çš„æ˜¯3ä¸ªä¸ªå¸¸ç”¨è”æŽ¥è¿ç®—ç¬¦ï¼šåˆå¹¶è”æŽ¥ï¼ˆMerge joinï¼‰ï¼Œå“ˆå¸Œè”æŽ¥ï¼ˆHash Joinï¼‰å’ŒåµŒå¥—å¾ªçŽ¯è”æŽ¥ï¼ˆNested Loop Joinï¼‰ã€‚ä½†æ˜¯åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘éœ€è¦å¼•å…¥æ–°è¯æ±‡äº†ï¼šå†…å…³ç³»å’Œå¤–å…³ç³»ï¼ˆ inner relation and outer relationï¼‰è¿™é‡Œçš„å…³ç³»å¯ä»¥æ˜¯ï¼š

- ä¸€ä¸ªè¡¨
- ä¸€ä¸ªç´¢å¼•
- ä¸Šä¸€ä¸ªè¿ç®—çš„ä¸­é—´ç»“æžœï¼ˆæ¯”å¦‚ä¸Šä¸€ä¸ªè”æŽ¥è¿ç®—çš„ç»“æžœï¼‰

å½“ä½ è”æŽ¥ä¸¤ä¸ªå…³ç³»æ—¶ï¼Œè”æŽ¥ç®—æ³•å¯¹ä¸¤ä¸ªå…³ç³»çš„å¤„ç†æ˜¯ä¸åŒçš„ã€‚åœ¨æœ¬æ–‡å‰©ä½™éƒ¨åˆ†ï¼Œæˆ‘å°†å‡å®šï¼š

- å¤–å…³ç³»æ˜¯å·¦ä¾§æ•°æ®é›†
- å†…å…³ç³»æ˜¯å³ä¾§æ•°æ®é›†

æ¯”å¦‚ï¼Œ A JOIN B æ˜¯ A å’Œ B çš„è”æŽ¥ï¼Œè¿™é‡Œ A æ˜¯å¤–å…³ç³»ï¼ŒB æ˜¯å†…å…³ç³»ã€‚

å¤šæ•°æƒ…å†µä¸‹ï¼Œ **A JOIN B çš„æˆæœ¬è·Ÿ B JOIN A çš„æˆæœ¬æ˜¯ä¸åŒçš„**ã€‚

åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘è¿˜å°†å‡å®šå¤–å…³ç³»æœ‰ N ä¸ªå…ƒç´ ï¼Œå†…å…³ç³»æœ‰ M ä¸ªå…ƒç´ ã€‚è¦è®°ä½ï¼ŒçœŸå®žçš„ä¼˜åŒ–å™¨é€šè¿‡ç»Ÿè®¡çŸ¥é“ N å’Œ M çš„å€¼ã€‚

æ³¨ï¼šN å’Œ M æ˜¯å…³ç³»çš„åŸºæ•°ã€‚

##### åµŒå¥—å¾ªçŽ¯è”æŽ¥

åµŒå¥—å¾ªçŽ¯è”æŽ¥æ˜¯æœ€ç®€å•çš„ã€‚

![sb-sql-learn-5](Images/sb-sql-learn-5.png)



åŽŸå› å¦‚ä¸‹ï¼š

- é’ˆå¯¹å¤–å…³ç³»çš„æ¯ä¸€è¡Œï¼ŒæŸ¥çœ‹å†…å…³ç³»é‡Œçš„æ‰€æœ‰è¡Œæ¥å¯»æ‰¾åŒ¹é…çš„è¡Œ

ä¸‹é¢æ˜¯ä¼ªä»£ç ï¼š

```java
nested_loop_join(array outer, array inner)
  for each row a in outer
    for each row b in inner
      if (match_join_condition(a,b))
        write_result_in_output(a,b)
      end if
    end for
   end for
```



ç”±äºŽè¿™æ˜¯ä¸ªåŒè¿­ä»£ï¼Œ**æ—¶é—´å¤æ‚åº¦æ˜¯ O(N\*M)**ã€‚

åœ¨ç£ç›˜ I/O æ–¹é¢ï¼Œ é’ˆå¯¹ N è¡Œå¤–å…³ç³»çš„æ¯ä¸€è¡Œï¼Œå†…éƒ¨å¾ªçŽ¯éœ€è¦ä»Žå†…å…³ç³»è¯»å– M è¡Œã€‚è¿™ä¸ªç®—æ³•éœ€è¦ä»Žç£ç›˜è¯»å– N+ N*M è¡Œã€‚ä½†æ˜¯ï¼Œå¦‚æžœå†…å…³ç³»è¶³å¤Ÿå°ï¼Œä½ å¯ä»¥æŠŠå®ƒè¯»å…¥å†…å­˜ï¼Œé‚£ä¹ˆå°±åªå‰©ä¸‹ M + N æ¬¡è¯»å–ã€‚è¿™æ ·ä¿®æ”¹ä¹‹åŽï¼Œå†…å…³ç³»å¿…é¡»æ˜¯æœ€å°çš„ï¼Œå› ä¸ºå®ƒæœ‰æ›´å¤§æœºä¼šè£…å…¥å†…å­˜ã€‚

åœ¨CPUæˆæœ¬æ–¹é¢æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä½†æ˜¯åœ¨ç£ç›˜ I/O æ–¹é¢ï¼Œæœ€å¥½æœ€å¥½çš„ï¼Œæ˜¯æ¯ä¸ªå…³ç³»åªè¯»å–ä¸€æ¬¡ã€‚

å½“ç„¶ï¼Œå†…å…³ç³»å¯ä»¥ç”±ç´¢å¼•ä»£æ›¿ï¼Œå¯¹ç£ç›˜ I/O æ›´æœ‰åˆ©ã€‚

ç”±äºŽè¿™ä¸ªç®—æ³•éžå¸¸ç®€å•ï¼Œä¸‹é¢è¿™ä¸ªç‰ˆæœ¬åœ¨å†…å…³ç³»å¤ªå¤§æ— æ³•è£…å…¥å†…å­˜æ—¶ï¼Œå¯¹ç£ç›˜ I/O æ›´åŠ æœ‰åˆ©ã€‚åŽŸå› å¦‚ä¸‹ï¼š

- ä¸ºäº†é¿å…é€è¡Œè¯»å–ä¸¤ä¸ªå…³ç³»ï¼Œ
- ä½ å¯ä»¥æˆç°‡è¯»å–ï¼ŒæŠŠï¼ˆä¸¤ä¸ªå…³ç³»é‡Œè¯»åˆ°çš„ï¼‰ä¸¤ç°‡æ•°æ®è¡Œä¿å­˜åœ¨å†…å­˜é‡Œï¼Œ
- æ¯”è¾ƒä¸¤ç°‡æ•°æ®ï¼Œä¿ç•™åŒ¹é…çš„ï¼Œ
- ç„¶åŽä»Žç£ç›˜åŠ è½½æ–°çš„æ•°æ®ç°‡æ¥ç»§ç»­æ¯”è¾ƒ
- ç›´åˆ°åŠ è½½äº†æ‰€æœ‰æ•°æ®ã€‚

å¯èƒ½çš„ç®—æ³•å¦‚ä¸‹ï¼š

```java
// improved version to reduce the disk I/O.
nested_loop_join_v2(file outer, file inner)
  for each bunch ba in outer
  // ba is now in memory
    for each bunch bb in inner
        // bb is now in memory
        for each row a in ba
          for each row b in bb
            if (match_join_condition(a,b))
              write_result_in_output(a,b)
            end if
          end for
       end for
    end for
   end for
```

**ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬ï¼Œæ—¶é—´å¤æ‚åº¦æ²¡æœ‰å˜åŒ–ï¼Œä½†æ˜¯ç£ç›˜è®¿é—®é™ä½Žäº†**ï¼š

- ç”¨å‰ä¸€ä¸ªç‰ˆæœ¬ï¼Œç®—æ³•éœ€è¦ N + N*M æ¬¡è®¿é—®ï¼ˆæ¯æ¬¡è®¿é—®è¯»å–ä¸€è¡Œï¼‰ã€‚
- ç”¨æ–°ç‰ˆæœ¬ï¼Œç£ç›˜è®¿é—®å˜ä¸º å¤–å…³ç³»çš„æ•°æ®ç°‡æ•°é‡ + å¤–å…³ç³»çš„æ•°æ®ç°‡æ•°é‡ * å†…å…³ç³»çš„æ•°æ®ç°‡æ•°é‡ã€‚
- å¢žåŠ æ•°æ®ç°‡çš„å°ºå¯¸ï¼Œå¯ä»¥é™ä½Žç£ç›˜è®¿é—®ã€‚

##### å“ˆå¸Œè”æŽ¥

å“ˆå¸Œè”æŽ¥æ›´å¤æ‚ï¼Œä¸è¿‡åœ¨å¾ˆå¤šåœºåˆæ¯”åµŒå¥—å¾ªçŽ¯è”æŽ¥æˆæœ¬ä½Žã€‚

![sb-sql-learn-6](Images/sb-sql-learn-6.png)



å“ˆå¸Œè”æŽ¥çš„åŽŸç†æ˜¯ï¼š

- è¯»å–å†…å…³ç³»çš„æ‰€æœ‰å…ƒç´ 
- åœ¨å†…å­˜é‡Œå»ºä¸€ä¸ªå“ˆå¸Œè¡¨
- é€æ¡è¯»å–å¤–å…³ç³»çš„æ‰€æœ‰å…ƒç´  +ï¼ˆç”¨å“ˆå¸Œè¡¨çš„å“ˆå¸Œå‡½æ•°ï¼‰è®¡ç®—æ¯ä¸ªå…ƒç´ çš„å“ˆå¸Œå€¼ï¼Œæ¥æŸ¥æ‰¾å†…å…³ç³»é‡Œç›¸å…³çš„å“ˆå¸Œæ¡¶å†…
- æ˜¯å¦ä¸Žå¤–å…³ç³»çš„å…ƒç´ åŒ¹é…ã€‚

åœ¨æ—¶é—´å¤æ‚åº¦æ–¹é¢æˆ‘éœ€è¦åšäº›å‡è®¾æ¥ç®€åŒ–é—®é¢˜ï¼š

- å†…å…³ç³»è¢«åˆ’åˆ†æˆ X ä¸ªå“ˆå¸Œæ¡¶
- å“ˆå¸Œå‡½æ•°å‡ ä¹Žå‡åŒ€åœ°åˆ†å¸ƒæ¯ä¸ªå…³ç³»å†…æ•°æ®çš„å“ˆå¸Œå€¼ï¼Œå°±æ˜¯è¯´å“ˆå¸Œæ¡¶å¤§å°ä¸€è‡´ã€‚
- å¤–å…³ç³»çš„å…ƒç´ ä¸Žå“ˆå¸Œæ¡¶å†…çš„æ‰€æœ‰å…ƒç´ çš„åŒ¹é…ï¼Œæˆæœ¬æ˜¯å“ˆå¸Œæ¡¶å†…å…ƒç´ çš„æ•°é‡ã€‚

æ—¶é—´å¤æ‚åº¦æ˜¯ (M/X) * N + åˆ›å»ºå“ˆå¸Œè¡¨çš„æˆæœ¬(M) + å“ˆå¸Œå‡½æ•°çš„æˆæœ¬ * N ã€‚å¦‚æžœå“ˆå¸Œå‡½æ•°åˆ›å»ºäº†è¶³å¤Ÿå°è§„æ¨¡çš„å“ˆå¸Œæ¡¶ï¼Œé‚£ä¹ˆå¤æ‚åº¦å°±æ˜¯ O(M+N)ã€‚

è¿˜æœ‰ä¸ªå“ˆå¸Œè”æŽ¥çš„ç‰ˆæœ¬ï¼Œå¯¹å†…å­˜æœ‰åˆ©ä½†æ˜¯å¯¹ç£ç›˜ I/O ä¸å¤Ÿæœ‰åˆ©ã€‚ è¿™å›žæ˜¯è¿™æ ·çš„ï¼š

- è®¡ç®—å†…å…³ç³»å’Œå¤–å…³ç³»åŒæ–¹çš„å“ˆå¸Œè¡¨
- ä¿å­˜å“ˆå¸Œè¡¨åˆ°ç£ç›˜
- ç„¶åŽé€ä¸ªå“ˆå¸Œæ¡¶æ¯”è¾ƒï¼ˆå…¶ä¸­ä¸€ä¸ªè¯»å…¥å†…å­˜ï¼Œå¦ä¸€ä¸ªé€è¡Œè¯»å–ï¼‰ã€‚



##### åˆå¹¶è”æŽ¥

åˆå¹¶è”æŽ¥æ˜¯å”¯ä¸€äº§ç”ŸæŽ’åºçš„è”æŽ¥ç®—æ³•ã€‚



æ³¨ï¼šè¿™ä¸ªç®€åŒ–çš„åˆå¹¶è”æŽ¥ä¸åŒºåˆ†å†…è¡¨æˆ–å¤–è¡¨ï¼›ä¸¤ä¸ªè¡¨æ‰®æ¼”åŒæ ·çš„è§’è‰²ã€‚ä½†æ˜¯çœŸå®žçš„å®žçŽ°æ–¹å¼æ˜¯ä¸åŒçš„ï¼Œæ¯”å¦‚å½“å¤„ç†é‡å¤å€¼æ—¶ã€‚

- 1.ï¼ˆå¯é€‰ï¼‰æŽ’åºè”æŽ¥è¿ç®—ï¼šä¸¤ä¸ªè¾“å…¥æºéƒ½æŒ‰ç…§è”æŽ¥å…³é”®å­—æŽ’åºã€‚

- 2.åˆå¹¶è”æŽ¥è¿ç®—ï¼šæŽ’åºåŽçš„è¾“å…¥æºåˆå¹¶åˆ°ä¸€èµ·ã€‚

  

**æŽ’åº**

æˆ‘ä»¬å·²ç»è°ˆåˆ°è¿‡åˆå¹¶æŽ’åºï¼Œåœ¨è¿™é‡Œåˆå¹¶æŽ’åºæ˜¯ä¸ªå¾ˆå¥½çš„ç®—æ³•ï¼ˆä½†æ˜¯å¹¶éžæœ€å¥½çš„ï¼Œå¦‚æžœå†…å­˜è¶³å¤Ÿç”¨çš„è¯ï¼Œè¿˜æ˜¯å“ˆå¸Œè”æŽ¥æ›´å¥½ï¼‰ã€‚

ç„¶è€Œæœ‰æ—¶æ•°æ®é›†å·²ç»æŽ’åºäº†ï¼Œæ¯”å¦‚ï¼š

- å¦‚æžœè¡¨å†…éƒ¨å°±æ˜¯æœ‰åºçš„ï¼Œæ¯”å¦‚è”æŽ¥æ¡ä»¶é‡Œä¸€ä¸ªç´¢å¼•ç»„ç»‡è¡¨(index-organized table)
- å¦‚æžœå…³ç³»æ˜¯è”æŽ¥æ¡ä»¶é‡Œçš„ä¸€ä¸ªç´¢å¼•
- å¦‚æžœè”æŽ¥åº”ç”¨åœ¨ä¸€ä¸ªæŸ¥è¯¢ä¸­å·²ç»æŽ’åºçš„ä¸­é—´ç»“æžœ
- **åˆå¹¶è”æŽ¥**

![sb-sql-learn-7](Images/sb-sql-learn-7.png)



è¿™éƒ¨åˆ†ä¸Žæˆ‘ä»¬ç ”ç©¶è¿‡çš„åˆå¹¶æŽ’åºä¸­çš„åˆå¹¶è¿ç®—éžå¸¸ç›¸ä¼¼ã€‚ä¸è¿‡è¿™ä¸€æ¬¡å‘¢ï¼Œæˆ‘ä»¬ä¸æ˜¯ä»Žä¸¤ä¸ªå…³ç³»é‡ŒæŒ‘é€‰æ‰€æœ‰å…ƒç´ ï¼Œè€Œæ˜¯åªæŒ‘é€‰ç›¸åŒçš„å…ƒç´ ã€‚é“ç†å¦‚ä¸‹ï¼š

- åœ¨ä¸¤ä¸ªå…³ç³»ä¸­ï¼Œæ¯”è¾ƒå½“å‰å…ƒç´ ï¼ˆå½“å‰=å¤´ä¸€æ¬¡å‡ºçŽ°çš„ç¬¬ä¸€ä¸ªï¼‰
- å¦‚æžœç›¸åŒï¼Œå°±æŠŠä¸¤ä¸ªå…ƒç´ éƒ½æ”¾å…¥ç»“æžœï¼Œå†æ¯”è¾ƒä¸¤ä¸ªå…³ç³»é‡Œçš„ä¸‹ä¸€ä¸ªå…ƒç´ 
- å¦‚æžœä¸åŒï¼Œå°±åŽ»å¸¦æœ‰æœ€å°å…ƒç´ çš„å…³ç³»é‡Œæ‰¾ä¸‹ä¸€ä¸ªå…ƒç´ ï¼ˆå› ä¸ºä¸‹ä¸€ä¸ªå…ƒç´ å¯èƒ½ä¼šåŒ¹é…ï¼‰
- é‡å¤ 1ã€2ã€3æ­¥éª¤ç›´åˆ°å…¶ä¸­ä¸€ä¸ªå…³ç³»çš„æœ€åŽä¸€ä¸ªå…ƒç´ ã€‚

å› ä¸ºä¸¤ä¸ªå…³ç³»éƒ½æ˜¯å·²æŽ’åºçš„ï¼Œä½ ä¸éœ€è¦ã€Žå›žå¤´åŽ»æ‰¾ã€ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ˜¯æœ‰æ•ˆçš„ã€‚

è¯¥ç®—æ³•æ˜¯ä¸ªç®€åŒ–ç‰ˆï¼Œå› ä¸ºå®ƒæ²¡æœ‰å¤„ç†ä¸¤ä¸ªåºåˆ—ä¸­ç›¸åŒæ•°æ®å‡ºçŽ°å¤šæ¬¡çš„æƒ…å†µï¼ˆå³å¤šé‡åŒ¹é…ï¼‰ã€‚çœŸå®žç‰ˆæœ¬ã€Žä»…ä»…ã€é’ˆå¯¹æœ¬ä¾‹å°±æ›´åŠ å¤æ‚ï¼Œæ‰€ä»¥æˆ‘æ‰é€‰æ‹©ç®€åŒ–ç‰ˆã€‚

å¦‚æžœä¸¤ä¸ªå…³ç³»éƒ½å·²ç»æŽ’åºï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(N+M)

å¦‚æžœä¸¤ä¸ªå…³ç³»éœ€è¦æŽ’åºï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯å¯¹ä¸¤ä¸ªå…³ç³»æŽ’åºçš„æˆæœ¬ï¼šO(N*Log(N) + M*Log(M))

##### å“ªä¸ªç®—æ³•æœ€å¥½

å¦‚æžœæœ‰æœ€å¥½çš„ï¼Œå°±æ²¡å¿…è¦å¼„é‚£ä¹ˆå¤šç§ç±»åž‹äº†ã€‚è¿™ä¸ªé—®é¢˜å¾ˆéš¾ï¼Œå› ä¸ºå¾ˆå¤šå› ç´ éƒ½è¦è€ƒè™‘ï¼Œæ¯”å¦‚ï¼š

- **ç©ºé—²å†…å­˜**ï¼šæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜çš„è¯å°±è·Ÿå¼ºå¤§çš„å“ˆå¸Œè”æŽ¥æ‹œæ‹œå§ï¼ˆè‡³å°‘æ˜¯å®Œå…¨å†…å­˜ä¸­å“ˆå¸Œè”æŽ¥ï¼‰ã€‚
- **ä¸¤ä¸ªæ•°æ®é›†çš„å¤§å°**ã€‚æ¯”å¦‚ï¼Œå¦‚æžœä¸€ä¸ªå¤§è¡¨è”æŽ¥ä¸€ä¸ªå¾ˆå°çš„è¡¨ï¼Œé‚£ä¹ˆåµŒå¥—å¾ªçŽ¯è”æŽ¥å°±æ¯”å“ˆå¸Œè”æŽ¥å¿«ï¼Œå› ä¸ºåŽè€…æœ‰åˆ›å»ºå“ˆå¸Œçš„é«˜æ˜‚æˆæœ¬ï¼›å¦‚æžœä¸¤ä¸ªè¡¨éƒ½éžå¸¸å¤§ï¼Œé‚£ä¹ˆåµŒå¥—å¾ªçŽ¯è”æŽ¥CPUæˆæœ¬å°±å¾ˆé«˜æ˜‚ã€‚
- **æ˜¯å¦æœ‰ç´¢å¼•**ï¼šæœ‰ä¸¤ä¸ª B+æ ‘ç´¢å¼•çš„è¯ï¼Œèªæ˜Žçš„é€‰æ‹©ä¼¼ä¹Žæ˜¯åˆå¹¶è”æŽ¥ã€‚
- **ç»“æžœæ˜¯å¦éœ€è¦æŽ’åº**ï¼šå³ä½¿ä½ ç”¨åˆ°çš„æ˜¯æœªæŽ’åºçš„æ•°æ®é›†ï¼Œä½ ä¹Ÿå¯èƒ½æƒ³ç”¨æˆæœ¬è¾ƒé«˜çš„åˆå¹¶è”æŽ¥ï¼ˆå¸¦æŽ’åºçš„ï¼‰ï¼Œå› ä¸ºæœ€ç»ˆå¾—åˆ°æŽ’åºçš„ç»“æžœåŽï¼Œä½ å¯ä»¥æŠŠå®ƒå’Œå¦ä¸€ä¸ªåˆå¹¶è”æŽ¥ä¸²èµ·æ¥ï¼ˆæˆ–è€…ä¹Ÿè®¸å› ä¸ºæŸ¥è¯¢ç”¨ ORDER BY/GROUP BY/DISTINCT ç­‰æ“ä½œç¬¦éšå¼æˆ–æ˜¾å¼åœ°è¦æ±‚ä¸€ä¸ªæŽ’åºç»“æžœï¼‰ã€‚
- **å…³ç³»æ˜¯å¦å·²ç»æŽ’åº**ï¼šè¿™æ—¶å€™åˆå¹¶è”æŽ¥æ˜¯æœ€å¥½çš„å€™é€‰é¡¹ã€‚
- **è”æŽ¥çš„ç±»åž‹**ï¼šæ˜¯ç­‰å€¼è”æŽ¥ï¼ˆæ¯”å¦‚ tableA.col1 = tableB.col2 ï¼‰ï¼Ÿ è¿˜æ˜¯å†…è”æŽ¥ï¼Ÿå¤–è”æŽ¥ï¼Ÿç¬›å¡å°”ä¹˜ç§¯ï¼Ÿæˆ–è€…è‡ªè”æŽ¥ï¼Ÿæœ‰äº›è”æŽ¥åœ¨ç‰¹å®šçŽ¯å¢ƒä¸‹æ˜¯æ— æ³•å·¥ä½œçš„ã€‚
- **æ•°æ®çš„åˆ†å¸ƒ**ï¼šå¦‚æžœè”æŽ¥æ¡ä»¶çš„æ•°æ®æ˜¯å€¾æ–œçš„ï¼ˆæ¯”å¦‚æ ¹æ®å§“æ°æ¥è”æŽ¥äººï¼Œä½†æ˜¯å¾ˆå¤šäººåŒå§“ï¼‰ï¼Œç”¨å“ˆå¸Œè”æŽ¥å°†æ˜¯ä¸ªç¾éš¾ï¼ŒåŽŸå› æ˜¯å“ˆå¸Œå‡½æ•°å°†äº§ç”Ÿåˆ†å¸ƒæžä¸å‡åŒ€çš„å“ˆå¸Œæ¡¶ã€‚
- å¦‚æžœä½ å¸Œæœ›è”æŽ¥æ“ä½œä½¿ç”¨**å¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹**ã€‚

æƒ³è¦æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¯ä»¥é˜…è¯»DB2, ORACLE æˆ– SQL Server)çš„æ–‡æ¡£ã€‚

#### ç®€åŒ–çš„ä¾‹å­

æˆ‘ä»¬å·²ç»ç ”ç©¶äº† 3 ç§ç±»åž‹çš„è”æŽ¥æ“ä½œã€‚çŽ°åœ¨ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è¦è”æŽ¥ 5 ä¸ªè¡¨ï¼Œæ¥èŽ·å¾—ä¸€ä¸ªäººçš„å…¨éƒ¨ä¿¡æ¯ã€‚ä¸€ä¸ªäººå¯ä»¥æœ‰ï¼š

- å¤šä¸ªæ‰‹æœºå·ï¼ˆMOBILESï¼‰
- å¤šä¸ªé‚®ç®±ï¼ˆMAILSï¼‰
- å¤šä¸ªåœ°å€ï¼ˆADRESSESï¼‰
- å¤šä¸ªé“¶è¡Œè´¦å·ï¼ˆBANK_ACCOUNTSï¼‰

æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ä¸‹é¢çš„æŸ¥è¯¢å¿«é€Ÿå¾—åˆ°ç­”æ¡ˆï¼š

```sql
SELECT * from PERSON, MOBILES, MAILS,ADRESSES, BANK_ACCOUNTS
WHERE
PERSON.PERSON_ID = MOBILES.PERSON_ID
AND PERSON.PERSON_ID = MAILS.PERSON_ID
AND PERSON.PERSON_ID = ADRESSES.PERSON_ID
AND PERSON.PERSON_ID = BANK_ACCOUNTS.PERSON_ID
```



ä½œä¸ºä¸€ä¸ªæŸ¥è¯¢ä¼˜åŒ–å™¨ï¼Œæˆ‘å¿…é¡»æ‰¾åˆ°å¤„ç†æ•°æ®æœ€å¥½çš„æ–¹æ³•ã€‚ä½†æœ‰ 2 ä¸ªé—®é¢˜ï¼š

- æ¯ä¸ªè”æŽ¥ä½¿ç”¨é‚£ç§ç±»åž‹ï¼Ÿ
  - æˆ‘æœ‰ 3 ç§å¯é€‰ï¼ˆå“ˆå¸Œã€åˆå¹¶ã€åµŒå¥—ï¼‰ï¼ŒåŒæ—¶å¯èƒ½ç”¨åˆ° 0, 1 æˆ– 2 ä¸ªç´¢å¼•ï¼ˆä¸å¿…è¯´è¿˜æœ‰å¤šç§ç±»åž‹çš„ç´¢å¼•ï¼‰ã€‚
- æŒ‰ä»€ä¹ˆé¡ºåºæ‰§è¡Œè”æŽ¥ï¼Ÿ

æ¯”å¦‚ï¼Œä¸‹å›¾æ˜¾ç¤ºäº†é’ˆå¯¹ 4 ä¸ªè¡¨ä»…ä»… 3 æ¬¡è”æŽ¥ï¼Œå¯èƒ½é‡‡ç”¨çš„æ‰§è¡Œè®¡åˆ’ï¼š

![sb-sql-learn-8](Images/sb-sql-learn-8.png)



çŽ°å®žä¸–ç•Œçš„æŸ¥è¯¢è¿˜ä¼šæœ‰å…¶ä»–å…³ç³»è¿ç®—ç¬¦ï¼Œåƒ OUTER JOIN, CROSS JOIN, GROUP BY, ORDER BY, PROJECTION, UNION, INTERSECT, DISTINCT â€¦ è¿™æ„å‘³ç€æ›´å¤šçš„å¯èƒ½æ€§ã€‚

**é‚£ä¹ˆï¼Œæ•°æ®åº“æ˜¯å¦‚ä½•å¤„ç†çš„å‘¢**ï¼Ÿ

```
åŠ¨æ€è§„åˆ’`ï¼Œ`è´ªå¿ƒç®—æ³•`å’Œ`å¯å‘å¼ç®—æ³•
```

#### åŠ¨æ€è§„åˆ’ï¼Œè´ªå¿ƒç®—æ³•å’Œå¯å‘å¼ç®—æ³•

å…³ç³»åž‹æ•°æ®åº“ä¼šå°è¯•æˆ‘åˆšåˆšæåˆ°çš„å¤šç§æ–¹æ³•ï¼Œ**ä¼˜åŒ–å™¨çœŸæ­£çš„å·¥ä½œæ˜¯åœ¨æœ‰é™æ—¶é—´é‡Œæ‰¾åˆ°ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆ**ã€‚

å¤šæ•°æ—¶å€™ï¼Œä¼˜åŒ–å™¨æ‰¾åˆ°çš„ä¸æ˜¯æœ€ä½³çš„æ–¹æ¡ˆï¼Œè€Œæ˜¯ä¸€ä¸ªã€Žä¸é”™ã€çš„



- **åŠ¨æ€è§„åˆ’**

å¯¹äºŽå°è§„æ¨¡çš„æŸ¥è¯¢ï¼Œé‡‡å–ç²—æš´çš„æ–¹å¼æ˜¯æœ‰å¯èƒ½çš„ã€‚ä½†æ˜¯ä¸ºäº†è®©ä¸­ç­‰è§„æ¨¡çš„æŸ¥è¯¢ä¹Ÿèƒ½é‡‡å–ç²—æš´çš„æ–¹å¼ï¼Œæˆ‘ä»¬æœ‰åŠžæ³•é¿å…ä¸å¿…è¦çš„è®¡ç®—ï¼Œè¿™å°±æ˜¯åŠ¨æ€è§„åˆ’ã€‚



è¿™å‡ ä¸ªå­—èƒŒåŽçš„ç†å¿µæ˜¯ï¼Œå¾ˆå¤šæ‰§è¡Œè®¡åˆ’æ˜¯éžå¸¸ç›¸ä¼¼çš„ã€‚çœ‹çœ‹ä¸‹å›¾è¿™å‡ ç§è®¡åˆ’ï¼š

![sb-sql-learn-9](Images/sb-sql-learn-9.png)



å®ƒä»¬éƒ½æœ‰ç›¸åŒçš„å­æ ‘ï¼ˆA JOIN Bï¼‰ï¼Œæ‰€ä»¥ï¼Œä¸å¿…åœ¨æ¯ä¸ªè®¡åˆ’ä¸­è®¡ç®—è¿™ä¸ªå­æ ‘çš„æˆæœ¬ï¼Œè®¡ç®—ä¸€æ¬¡ï¼Œä¿å­˜ç»“æžœï¼Œå½“å†é‡åˆ°è¿™ä¸ªå­æ ‘æ—¶é‡ç”¨ã€‚ç”¨æ›´æ­£è§„çš„è¯´æ³•ï¼Œæˆ‘ä»¬é¢å¯¹çš„æ˜¯ä¸ªé‡å é—®é¢˜ã€‚ä¸ºäº†é¿å…å¯¹éƒ¨åˆ†ç»“æžœçš„é‡å¤è®¡ç®—ï¼Œæˆ‘ä»¬ä½¿ç”¨è®°å¿†æ³•ã€‚

åº”ç”¨è¿™ä¸€æŠ€æœ¯ï¼Œæˆ‘ä»¬ä¸å†æœ‰ (2*N)!/(N+1)! çš„å¤æ‚åº¦ï¼Œè€Œæ˜¯â€œåªæœ‰â€ 3^Nã€‚åœ¨ä¹‹å‰ 4 ä¸ªJOIN çš„ä¾‹å­é‡Œï¼Œè¿™æ„å‘³ç€å°† 336 æ¬¡æŽ’åºé™ä¸º 81 æ¬¡ã€‚å¦‚æžœæ˜¯å¤§ä¸€äº›çš„æŸ¥è¯¢ï¼Œæ¯”å¦‚ 8 ä¸ª JOIN ï¼ˆå…¶å®žä¹Ÿä¸æ˜¯å¾ˆå¤§å•¦ï¼‰ï¼Œå°±æ˜¯å°† 57,657,600 æ¬¡é™ä¸º 6551 æ¬¡ã€‚

é’ˆå¯¹å¤§è§„æ¨¡æŸ¥è¯¢ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨åŠ¨æ€è§„åˆ’æ–¹æ³•ï¼Œä½†æ˜¯è¦é™„åŠ é¢å¤–çš„è§„åˆ™ï¼ˆæˆ–è€…ç§°ä¸ºå¯å‘å¼ç®—æ³•ï¼‰æ¥å‡å°‘å¯èƒ½æ€§ã€‚

- å¦‚æžœæˆ‘ä»¬ä»…åˆ†æžä¸€ä¸ªç‰¹å®šç±»åž‹çš„è®¡åˆ’ï¼ˆä¾‹å¦‚å·¦æ·±æ ‘ left-deep treeï¼Œå‚è€ƒ)ï¼Œæˆ‘ä»¬å¾—åˆ° n*2^n è€Œä¸æ˜¯ 3^nã€‚

![sb-sql-learn-10](Images/sb-sql-learn-10.png)



* å¦‚æžœæˆ‘ä»¬åŠ ä¸Šé€»è¾‘è§„åˆ™æ¥é¿å…ä¸€äº›æ¨¡å¼çš„è®¡åˆ’ï¼ˆåƒã€Žå¦‚æžœä¸€ä¸ªè¡¨æœ‰é’ˆå¯¹æŒ‡å®šè°“è¯çš„ç´¢å¼•ï¼Œå°±ä¸è¦å¯¹è¡¨å°è¯•åˆå¹¶è”æŽ¥ï¼Œè¦å¯¹ç´¢å¼•ã€ï¼‰ï¼Œå°±ä¼šåœ¨ä¸ç»™æœ€ä½³æ–¹æ¡ˆé€ æˆè¿‡å¤šä¼¤å®³çš„å‰æä¸‹ï¼Œå‡å°‘å¯èƒ½æ€§çš„æ•°é‡ã€‚ã€è¯‘è€…æ³¨ï¼šåŽŸæ–‡åº”è¯¥æ˜¯æœ‰ä¸¤å¤„ç¬”è¯¯ï¼š as=has, to=tooã€‘



* å¦‚æžœæˆ‘ä»¬åœ¨æµç¨‹é‡Œå¢žåŠ è§„åˆ™ï¼ˆåƒã€Žè”æŽ¥è¿ç®—å…ˆäºŽå…¶ä»–æ‰€æœ‰çš„å…³ç³»è¿ç®—ã€ï¼‰ï¼Œä¹Ÿèƒ½å‡å°‘å¤§é‡çš„å¯èƒ½æ€§ã€‚



- **è´ªå¿ƒç®—æ³•**

ä½†æ˜¯ï¼Œä¼˜åŒ–å™¨é¢å¯¹ä¸€ä¸ªéžå¸¸å¤§çš„æŸ¥è¯¢ï¼Œæˆ–è€…ä¸ºäº†å°½å¿«æ‰¾åˆ°ç­”æ¡ˆï¼ˆç„¶è€ŒæŸ¥è¯¢é€Ÿåº¦å°±å¿«ä¸èµ·æ¥äº†ï¼‰ï¼Œä¼šåº”ç”¨å¦ä¸€ç§ç®—æ³•ï¼Œå«è´ªå©ªç®—æ³•ã€‚



åŽŸç†æ˜¯æŒ‰ç…§ä¸€ä¸ªè§„åˆ™ï¼ˆæˆ–å¯å‘ï¼‰ä»¥æ¸è¿›çš„æ–¹å¼åˆ¶å®šæŸ¥è¯¢è®¡åˆ’ã€‚åœ¨è¿™ä¸ªè§„åˆ™ä¸‹ï¼Œè´ªå©ªç®—æ³•é€æ­¥å¯»æ‰¾æœ€ä½³ç®—æ³•ï¼Œå…ˆå¤„ç†ä¸€æ¡JOINï¼ŒæŽ¥ç€æ¯ä¸€æ­¥æŒ‰ç…§åŒæ ·è§„åˆ™åŠ ä¸€æ¡æ–°çš„JOINã€‚

æˆ‘ä»¬æ¥çœ‹ä¸ªç®€å•çš„ä¾‹å­ã€‚æ¯”å¦‚ä¸€ä¸ªé’ˆå¯¹5å¼ è¡¨ï¼ˆA,B,C,D,Eï¼‰4æ¬¡JOIN çš„æŸ¥è¯¢ï¼Œä¸ºäº†ç®€åŒ–æˆ‘ä»¬æŠŠåµŒå¥—JOINä½œä¸ºå¯èƒ½çš„è”æŽ¥æ–¹å¼ï¼ŒæŒ‰ç…§ã€Žä½¿ç”¨æœ€ä½Žæˆæœ¬çš„è”æŽ¥ã€è§„åˆ™ã€‚

- ç›´æŽ¥ä»Ž 5 ä¸ªè¡¨é‡Œé€‰ä¸€ä¸ªå¼€å§‹ï¼ˆæ¯”å¦‚ Aï¼‰
- è®¡ç®—æ¯ä¸€ä¸ªä¸Ž A çš„è”æŽ¥ï¼ˆA ä½œä¸ºå†…å…³ç³»æˆ–å¤–å…³ç³»ï¼‰
- å‘çŽ° â€œA JOIN Bâ€ æˆæœ¬æœ€ä½Ž
- è®¡ç®—æ¯ä¸€ä¸ªä¸Ž â€œA JOIN Bâ€ çš„ç»“æžœè”æŽ¥çš„æˆæœ¬ï¼ˆâ€œA JOIN Bâ€ ä½œä¸ºå†…å…³ç³»æˆ–å¤–å…³ç³»ï¼‰
- å‘çŽ° â€œ(A JOIN B) JOIN Câ€ æˆæœ¬æœ€ä½Ž
- è®¡ç®—æ¯ä¸€ä¸ªä¸Ž â€œ(A JOIN B) JOIN Câ€ çš„ç»“æžœè”æŽ¥çš„æˆæœ¬
- â€¦â€¦
- æœ€åŽç¡®å®šæ‰§è¡Œè®¡åˆ’ â€œ( ( (A JOIN B) JOIN C) JOIN D ) JOIN E )â€

å› ä¸ºæˆ‘ä»¬æ˜¯æ­¦æ–­åœ°ä»Žè¡¨ A å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåŒæ ·çš„ç®—æ³•ç”¨åœ¨ Bï¼Œç„¶åŽ Cï¼Œç„¶åŽ D, ç„¶åŽ Eã€‚æœ€åŽä¿ç•™æˆæœ¬æœ€ä½Žçš„æ‰§è¡Œè®¡åˆ’ã€‚



é¡ºä¾¿è¯´ä¸€å¥ï¼Œè¿™ä¸ªç®—æ³•æœ‰ä¸ªåå­—ï¼Œå«ã€Žæœ€è¿‘é‚»å±…ç®—æ³•ã€ã€‚

æŠ›å¼€ç»†èŠ‚ä¸è°ˆï¼Œåªéœ€ä¸€ä¸ªè‰¯å¥½çš„æ¨¡åž‹å’Œä¸€ä¸ª N*log(N) å¤æ‚åº¦çš„æŽ’åºï¼Œé—®é¢˜å°±è½»æ¾è§£å†³äº†ã€‚è¿™ä¸ªç®—æ³•çš„å¤æ‚åº¦æ˜¯ O(N*log(N)) ï¼Œå¯¹æ¯”ä¸€ä¸‹å®Œå…¨åŠ¨æ€è§„åˆ’çš„ O(3^N)ã€‚å¦‚æžœä½ æœ‰ä¸ª20ä¸ªè”æŽ¥çš„å¤§åž‹æŸ¥è¯¢ï¼Œè¿™æ„å‘³ç€ 26 vs 3,486,784,401 ï¼Œå¤©å£¤ä¹‹åˆ«ï¼



è¿™ä¸ªç®—æ³•çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬åšçš„å‡è®¾æ˜¯ï¼šæ‰¾åˆ° 2 ä¸ªè¡¨çš„æœ€ä½³è”æŽ¥æ–¹æ³•ï¼Œä¿ç•™è¿™ä¸ªè”æŽ¥ç»“æžœï¼Œå†è”æŽ¥ä¸‹ä¸€ä¸ªè¡¨ï¼Œå°±èƒ½å¾—åˆ°æœ€ä½Žçš„æˆæœ¬ã€‚ä½†æ˜¯ï¼š

- å³ä½¿åœ¨ A, B, C ä¹‹é—´ï¼ŒA JOIN B å¯å¾—æœ€ä½Žæˆæœ¬
- (A JOIN C) JOIN B ä¹Ÿè®¸æ¯” (A JOIN B) JOIN C æ›´å¥½ã€‚

ä¸ºäº†æ”¹å–„è¿™ä¸€çŠ¶å†µï¼Œä½ å¯ä»¥å¤šæ¬¡ä½¿ç”¨åŸºäºŽä¸åŒè§„åˆ™çš„è´ªå¿ƒç®—æ³•ï¼Œå¹¶ä¿ç•™æœ€ä½³çš„æ‰§è¡Œè®¡åˆ’ã€‚



#### æŸ¥è¯¢è®¡åˆ’ç¼“å­˜

ç”±äºŽåˆ›å»ºæŸ¥è¯¢è®¡åˆ’æ˜¯è€—æ—¶çš„ï¼Œå¤§å¤šæ•°æ®åº“æŠŠè®¡åˆ’ä¿å­˜åœ¨æŸ¥è¯¢è®¡åˆ’ç¼“å­˜ï¼Œæ¥é¿å…é‡å¤è®¡ç®—ã€‚è¿™ä¸ªè¯é¢˜æ¯”è¾ƒå¤§ï¼Œå› ä¸ºæ•°æ®åº“éœ€è¦çŸ¥é“ä»€ä¹ˆæ—¶å€™æ›´æ–°è¿‡æ—¶çš„è®¡åˆ’ã€‚åŠžæ³•æ˜¯è®¾ç½®ä¸€ä¸ªä¸Šé™ï¼Œå¦‚æžœä¸€ä¸ªè¡¨çš„ç»Ÿè®¡å˜åŒ–è¶…è¿‡äº†ä¸Šé™ï¼Œå…³äºŽè¯¥è¡¨çš„æŸ¥è¯¢è®¡åˆ’å°±ä»Žç¼“å­˜ä¸­æ¸…é™¤ã€‚



### æŸ¥è¯¢æ‰§è¡Œå™¨

åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªä¼˜åŒ–çš„æ‰§è¡Œè®¡åˆ’ï¼Œå†ç¼–è¯‘ä¸ºå¯æ‰§è¡Œä»£ç ã€‚ç„¶åŽï¼Œå¦‚æžœæœ‰è¶³å¤Ÿèµ„æºï¼ˆå†…å­˜ï¼ŒCPUï¼‰ï¼ŒæŸ¥è¯¢æ‰§è¡Œå™¨å°±ä¼šæ‰§è¡Œå®ƒã€‚è®¡åˆ’ä¸­çš„æ“ä½œç¬¦ (JOIN, SORT BY â€¦) å¯ä»¥é¡ºåºæˆ–å¹¶è¡Œæ‰§è¡Œï¼Œè¿™å–å†³äºŽæ‰§è¡Œå™¨ã€‚ä¸ºäº†èŽ·å¾—å’Œå†™å…¥æ•°æ®ï¼ŒæŸ¥è¯¢æ‰§è¡Œå™¨ä¸Žæ•°æ®ç®¡ç†å™¨äº¤äº’ï¼Œæœ¬æ–‡ä¸‹ä¸€éƒ¨åˆ†æ¥è®¨è®ºæ•°æ®ç®¡ç†å™¨ã€‚



## æ•°æ®ç®¡ç†å™¨

![sb-sql-learn-11](Images/sb-sql-learn-11.png)



åœ¨è¿™ä¸€æ­¥ï¼ŒæŸ¥è¯¢ç®¡ç†å™¨æ‰§è¡Œäº†æŸ¥è¯¢ï¼Œéœ€è¦ä»Žè¡¨å’Œç´¢å¼•èŽ·å–æ•°æ®ï¼ŒäºŽæ˜¯å‘æ•°æ®ç®¡ç†å™¨æå‡ºè¯·æ±‚ã€‚ä½†æ˜¯æœ‰ 2 ä¸ªé—®é¢˜ï¼š

- å…³ç³»åž‹æ•°æ®åº“ä½¿ç”¨äº‹åŠ¡æ¨¡åž‹ï¼Œæ‰€ä»¥ï¼Œå½“å…¶ä»–äººåœ¨åŒä¸€æ—¶åˆ»ä½¿ç”¨æˆ–ä¿®æ”¹æ•°æ®æ—¶ï¼Œä½ æ— æ³•å¾—åˆ°è¿™éƒ¨åˆ†æ•°æ®ã€‚
- æ•°æ®æå–æ˜¯æ•°æ®åº“ä¸­é€Ÿåº¦æœ€æ…¢çš„æ“ä½œï¼Œæ‰€ä»¥æ•°æ®ç®¡ç†å™¨éœ€è¦è¶³å¤Ÿèªæ˜Žåœ°èŽ·å¾—æ•°æ®å¹¶ä¿å­˜åœ¨å†…å­˜ç¼“å†²åŒºå†…ã€‚

åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬çœ‹çœ‹å…³ç³»åž‹æ•°æ®åº“æ˜¯å¦‚ä½•å¤„ç†è¿™ä¸¤ä¸ªé—®é¢˜çš„ã€‚



### ç¼“å­˜ç®¡ç†å™¨

å‰æ–‡å·²ç»è¯´è¿‡ï¼Œæ•°æ®åº“çš„ä¸»è¦ç“¶é¢ˆæ˜¯ç£ç›˜ I/Oã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼ŒçŽ°ä»£æ•°æ®åº“ä½¿ç”¨ç¼“å­˜ç®¡ç†å™¨ã€‚

![sb-sql-learn-12](Images/sb-sql-learn-12.png)



æŸ¥è¯¢æ‰§è¡Œå™¨ä¸ä¼šç›´æŽ¥ä»Žæ–‡ä»¶ç³»ç»Ÿæ‹¿æ•°æ®ï¼Œè€Œæ˜¯å‘ç¼“å­˜ç®¡ç†å™¨è¦ã€‚ç¼“å­˜ç®¡ç†å™¨æœ‰ä¸€ä¸ªå†…å­˜ç¼“å­˜åŒºï¼Œå«åšç¼“å†²æ± ï¼Œä»Žå†…å­˜è¯»å–æ•°æ®æ˜¾è‘—åœ°æå‡æ•°æ®åº“æ€§èƒ½ã€‚å¯¹æ­¤å¾ˆéš¾ç»™å‡ºä¸€ä¸ªæ•°é‡çº§ï¼Œå› ä¸ºè¿™å–å†³äºŽä½ éœ€è¦çš„æ˜¯å“ªç§æ“ä½œï¼š

- é¡ºåºè®¿é—®ï¼ˆæ¯”å¦‚ï¼šå…¨æ‰«æï¼‰ vs éšæœºè®¿é—®ï¼ˆæ¯”å¦‚ï¼šæŒ‰ç…§row idè®¿é—®ï¼‰
- è¯»è¿˜æ˜¯å†™

ä»¥åŠæ•°æ®åº“ä½¿ç”¨çš„ç£ç›˜ç±»åž‹ï¼š

- 7.2k/10k/15k rpmçš„ç¡¬ç›˜
- SSD
- RAID 1/5/â€¦

è¦æˆ‘è¯´ï¼Œå†…å­˜æ¯”ç£ç›˜è¦å¿«100åˆ°10ä¸‡å€ã€‚ç„¶è€Œï¼Œè¿™å¯¼è‡´äº†å¦ä¸€ä¸ªé—®é¢˜ï¼ˆæ•°æ®åº“æ€»æ˜¯è¿™æ ·â€¦)ï¼Œç¼“å­˜ç®¡ç†å™¨éœ€è¦åœ¨æŸ¥è¯¢æ‰§è¡Œå™¨ä½¿ç”¨æ•°æ®ä¹‹å‰å¾—åˆ°æ•°æ®ï¼Œå¦åˆ™æŸ¥è¯¢ç®¡ç†å™¨ä¸å¾—ä¸ç­‰å¾…æ•°æ®ä»Žç¼“æ…¢çš„ç£ç›˜ä¸­è¯»å‡ºæ¥ã€‚



#### é¢„è¯»

è¿™ä¸ªé—®é¢˜å«é¢„è¯»ã€‚æŸ¥è¯¢æ‰§è¡Œå™¨çŸ¥é“å®ƒå°†éœ€è¦ä»€ä¹ˆæ•°æ®ï¼Œå› ä¸ºå®ƒäº†è§£æ•´ä¸ªæŸ¥è¯¢æµï¼Œè€Œä¸”é€šè¿‡ç»Ÿè®¡ä¹Ÿäº†è§£ç£ç›˜ä¸Šçš„æ•°æ®ã€‚è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š

- å½“æŸ¥è¯¢æ‰§è¡Œå™¨å¤„ç†å®ƒçš„ç¬¬ä¸€æ‰¹æ•°æ®æ—¶ï¼Œä¼šå‘Šè¯‰ç¼“å­˜ç®¡ç†å™¨é¢„å…ˆè£…è½½ç¬¬äºŒæ‰¹æ•°æ®
- å½“å¼€å§‹å¤„ç†ç¬¬äºŒæ‰¹æ•°æ®æ—¶ï¼Œå‘Šè¯‰ç¼“å­˜ç®¡ç†å™¨é¢„å…ˆè£…è½½ç¬¬ä¸‰æ‰¹æ•°æ®ï¼Œå¹¶ä¸”å‘Šè¯‰ç¼“å­˜ç®¡ç†å™¨ç¬¬ä¸€æ‰¹å¯ä»¥ä»Žç¼“å­˜é‡Œæ¸…æŽ‰äº†ã€‚
- â€¦â€¦

ç¼“å­˜ç®¡ç†å™¨åœ¨ç¼“å†²æ± é‡Œä¿å­˜æ‰€æœ‰çš„è¿™äº›æ•°æ®ã€‚ä¸ºäº†ç¡®å®šä¸€æ¡æ•°æ®æ˜¯å¦æœ‰ç”¨ï¼Œç¼“å­˜ç®¡ç†å™¨ç»™ç¼“å­˜çš„æ•°æ®æ·»åŠ äº†é¢å¤–çš„ä¿¡æ¯ï¼ˆå«é—©é”ï¼‰ã€‚

æœ‰æ—¶æŸ¥è¯¢æ‰§è¡Œå™¨ä¸çŸ¥é“å®ƒéœ€è¦ä»€ä¹ˆæ•°æ®ï¼Œæœ‰çš„æ•°æ®åº“ä¹Ÿä¸æä¾›è¿™ä¸ªåŠŸèƒ½ã€‚ç›¸åï¼Œå®ƒä»¬ä½¿ç”¨ä¸€ç§æŽ¨æµ‹é¢„è¯»æ³•ï¼ˆæ¯”å¦‚ï¼šå¦‚æžœæŸ¥è¯¢æ‰§è¡Œå™¨æƒ³è¦æ•°æ®1ã€3ã€5ï¼Œå®ƒä¸ä¹…åŽå¾ˆå¯èƒ½ä¼šè¦ 7ã€9ã€11ï¼‰ï¼Œæˆ–è€…é¡ºåºé¢„è¯»æ³•ï¼ˆè¿™æ—¶å€™ç¼“å­˜ç®¡ç†å™¨åªæ˜¯è¯»å–ä¸€æ‰¹æ•°æ®åŽç®€å•åœ°ä»Žç£ç›˜åŠ è½½ä¸‹ä¸€æ‰¹è¿žç»­æ•°æ®ï¼‰ã€‚

ä¸ºäº†ç›‘æŽ§é¢„è¯»çš„å·¥ä½œçŠ¶å†µï¼ŒçŽ°ä»£æ•°æ®åº“å¼•å…¥äº†ä¸€ä¸ªåº¦é‡å«ç¼“å†²/ç¼“å­˜å‘½ä¸­çŽ‡ï¼Œç”¨æ¥æ˜¾ç¤ºè¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­æ‰¾åˆ°è€Œä¸æ˜¯ä»Žç£ç›˜è¯»å–çš„é¢‘çŽ‡ã€‚

æ³¨ï¼šç³Ÿç³•çš„ç¼“å­˜å‘½ä¸­çŽ‡ä¸æ€»æ˜¯æ„å‘³ç€ç¼“å­˜å·¥ä½œçŠ¶æ€ä¸ä½³ã€‚

ç¼“å†²åªæ˜¯å®¹é‡æœ‰é™çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤ï¼Œä¸ºäº†åŠ è½½æ–°çš„æ•°æ®ï¼Œå®ƒéœ€è¦ç§»é™¤ä¸€äº›æ•°æ®ã€‚åŠ è½½å’Œæ¸…é™¤ç¼“å­˜éœ€è¦ä¸€äº›ç£ç›˜å’Œç½‘ç»œI/Oçš„æˆæœ¬ã€‚å¦‚æžœä½ æœ‰ä¸ªç»å¸¸æ‰§è¡Œçš„æŸ¥è¯¢ï¼Œé‚£ä¹ˆæ¯æ¬¡éƒ½æŠŠæŸ¥è¯¢ç»“æžœåŠ è½½ç„¶åŽæ¸…é™¤ï¼Œæ•ˆçŽ‡å°±å¤ªä½Žäº†ã€‚çŽ°ä»£æ•°æ®åº“ç”¨ç¼“å†²åŒºç½®æ¢ç­–ç•¥æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚





#### ç¼“å†²åŒºç½®æ¢ç­–ç•¥

å¤šæ•°çŽ°ä»£æ•°æ®åº“(è‡³å°‘ SQL Server, MySQL, Oracle å’Œ DB2)ä½¿ç”¨ LRU ç®—æ³•ã€‚



##### LRU

LRUä»£è¡¨æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLeast Recently Usedï¼‰ç®—æ³•ï¼ŒèƒŒåŽçš„åŽŸç†æ˜¯ï¼šåœ¨ç¼“å­˜é‡Œä¿ç•™çš„æ•°æ®æ˜¯æœ€è¿‘ä½¿ç”¨çš„ï¼Œæ‰€ä»¥æ›´æœ‰å¯èƒ½å†æ¬¡ä½¿ç”¨ã€‚

å›¾è§£ï¼š

![sb-sql-learn-13](Images/sb-sql-learn-13.png)





ä¸ºäº†æ›´å¥½çš„ç†è§£ï¼Œæˆ‘å‡è®¾ç¼“å†²åŒºé‡Œçš„æ•°æ®æ²¡æœ‰è¢«é—©é”é”ä½ï¼ˆå°±æ˜¯è¯´æ˜¯å¯ä»¥è¢«ç§»é™¤çš„ï¼‰ã€‚åœ¨è¿™ä¸ªç®€å•çš„ä¾‹å­é‡Œï¼Œç¼“å†²åŒºå¯ä»¥ä¿å­˜ 3 ä¸ªå…ƒç´ ï¼š

- 1ï¼šç¼“å­˜ç®¡ç†å™¨ï¼ˆç®€ç§°CMï¼‰ä½¿ç”¨æ•°æ®1ï¼ŒæŠŠå®ƒæ”¾å…¥ç©ºçš„ç¼“å†²åŒº
- 2ï¼šCMä½¿ç”¨æ•°æ®4ï¼ŒæŠŠå®ƒæ”¾å…¥åŠè½½çš„ç¼“å†²åŒº
- 3ï¼šCMä½¿ç”¨æ•°æ®3ï¼ŒæŠŠå®ƒæ”¾å…¥åŠè½½çš„ç¼“å†²åŒº
- 4ï¼šCMä½¿ç”¨æ•°æ®9ï¼Œç¼“å†²åŒºæ»¡äº†ï¼Œæ‰€ä»¥æ•°æ®1è¢«æ¸…é™¤ï¼Œå› ä¸ºå®ƒæ˜¯æœ€åŽä¸€ä¸ªæœ€è¿‘ä½¿ç”¨çš„ï¼Œæ•°æ®9åŠ å…¥åˆ°ç¼“å†²åŒº
- 5ï¼šCMä½¿ç”¨æ•°æ®4ï¼Œæ•°æ®4å·²ç»åœ¨ç¼“å†²åŒºäº†ï¼Œæ‰€ä»¥å®ƒå†æ¬¡æˆä¸ºç¬¬ä¸€ä¸ªæœ€è¿‘ä½¿ç”¨çš„ã€‚
- 6ï¼šCMä½¿ç”¨æ•°æ®1ï¼Œç¼“å†²åŒºæ»¡äº†ï¼Œæ‰€ä»¥æ•°æ®9è¢«æ¸…é™¤ï¼Œå› ä¸ºå®ƒæ˜¯æœ€åŽä¸€ä¸ªæœ€è¿‘ä½¿ç”¨çš„ï¼Œæ•°æ®1åŠ å…¥åˆ°ç¼“å†²åŒº
- â€¦â€¦

è¿™ä¸ªç®—æ³•æ•ˆæžœå¾ˆå¥½ï¼Œä½†æ˜¯æœ‰äº›é™åˆ¶ã€‚**å¦‚æžœå¯¹ä¸€ä¸ªå¤§è¡¨æ‰§è¡Œå…¨è¡¨æ‰«ææ€Žä¹ˆåŠž**ï¼Ÿæ¢å¥è¯è¯´ï¼Œå½“è¡¨/ç´¢å¼•çš„å¤§å°è¶…å‡ºç¼“å†²åŒºä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿä½¿ç”¨è¿™ä¸ªç®—æ³•ä¼šæ¸…é™¤ä¹‹å‰ç¼“å­˜å†…æ‰€æœ‰çš„æ•°æ®ï¼Œè€Œä¸”å…¨æ‰«æçš„æ•°æ®å¾ˆå¯èƒ½åªä½¿ç”¨ä¸€æ¬¡ã€‚



##### æ”¹è¿›

ä¸ºäº†é˜²æ­¢è¿™ä¸ªçŽ°è±¡ï¼Œæœ‰äº›æ•°æ®åº“å¢žåŠ äº†ç‰¹æ®Šçš„è§„åˆ™ï¼Œæ¯”å¦‚Oracleæ–‡æ¡£ä¸­çš„æè¿°ï¼š



å¯¹éžå¸¸å¤§çš„è¡¨æ¥è¯´ï¼Œæ•°æ®åº“é€šå¸¸ä½¿ç”¨ç›´æŽ¥è·¯å¾„æ¥è¯»å–ï¼Œå³ç›´æŽ¥åŠ è½½åŒºå—[â€¦â€¦]ï¼Œæ¥é¿å…å¡«æ»¡ç¼“å†²åŒºã€‚å¯¹äºŽä¸­ç­‰å¤§å°çš„è¡¨ï¼Œæ•°æ®åº“å¯ä»¥ä½¿ç”¨ç›´æŽ¥è¯»å–æˆ–ç¼“å­˜è¯»å–ã€‚å¦‚æžœé€‰æ‹©ç¼“å­˜è¯»å–ï¼Œæ•°æ®åº“æŠŠåŒºå—ç½®äºŽLRUçš„å°¾éƒ¨ï¼Œé˜²æ­¢æ¸…ç©ºå½“å‰ç¼“å†²åŒºã€‚ã€



è¿˜æœ‰ä¸€äº›å¯èƒ½ï¼Œæ¯”å¦‚ä½¿ç”¨é«˜çº§ç‰ˆæœ¬çš„LRUï¼Œå«åš LRU-Kã€‚ä¾‹å¦‚ï¼ŒSQL Server ä½¿ç”¨ LRU-2ã€‚

è¿™ä¸ªç®—æ³•çš„åŽŸç†æ˜¯æŠŠæ›´å¤šçš„åŽ†å²è®°å½•è€ƒè™‘è¿›æ¥ã€‚ç®€å•LRUï¼ˆä¹Ÿå°±æ˜¯ LRU-1ï¼‰ï¼Œåªè€ƒè™‘æœ€åŽä¸€æ¬¡ä½¿ç”¨çš„æ•°æ®ã€‚LRU-Kå‘¢ï¼š

- è€ƒè™‘æ•°æ®æœ€åŽç¬¬Kæ¬¡ä½¿ç”¨çš„æƒ…å†µ
- æ•°æ®ä½¿ç”¨çš„æ¬¡æ•°åŠ è¿›äº†æƒé‡
- ä¸€æ‰¹æ–°æ•°æ®åŠ è½½è¿›å…¥ç¼“å­˜ï¼Œæ—§çš„ä½†æ˜¯ç»å¸¸ä½¿ç”¨çš„æ•°æ®ä¸ä¼šè¢«æ¸…é™¤ï¼ˆå› ä¸ºæƒé‡æ›´é«˜ï¼‰
- ä½†æ˜¯è¿™ä¸ªç®—æ³•ä¸ä¼šä¿ç•™ç¼“å­˜ä¸­ä¸å†ä½¿ç”¨çš„æ•°æ®
- æ‰€ä»¥æ•°æ®å¦‚æžœä¸å†ä½¿ç”¨ï¼Œæƒé‡å€¼éšç€æ—¶é—´æŽ¨ç§»è€Œé™ä½Ž

è®¡ç®—æƒé‡æ˜¯éœ€è¦æˆæœ¬çš„ï¼Œæ‰€ä»¥SQL Serveråªæ˜¯ä½¿ç”¨ K=2ï¼Œè¿™ä¸ªå€¼æ€§èƒ½ä¸é”™è€Œä¸”é¢å¤–å¼€é”€å¯ä»¥æŽ¥å—ã€‚



##### å…¶ä»–ç®—æ³•

å½“ç„¶è¿˜æœ‰å…¶ä»–ç®¡ç†ç¼“å­˜çš„ç®—æ³•ï¼Œæ¯”å¦‚ï¼š



* 2Qï¼ˆç±»LRU-Kç®—æ³•ï¼‰
* CLOCKï¼ˆç±»LRU-Kç®—æ³•ï¼‰
* MRUï¼ˆæœ€æ–°ä½¿ç”¨çš„ç®—æ³•ï¼Œç”¨LRUåŒæ ·çš„é€»è¾‘ä½†ä¸åŒçš„è§„åˆ™ï¼‰
* LRFUï¼ˆLeast Recently and Frequently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨æœ€è¿‘æœ€ä¸å¸¸ç”¨ï¼‰



#### å†™ç¼“å†²åŒº

æˆ‘åªæŽ¢è®¨äº†è¯»ç¼“å­˜ â€”â€” åœ¨ä½¿ç”¨ä¹‹å‰é¢„å…ˆåŠ è½½æ•°æ®ã€‚ç”¨æ¥ä¿å­˜æ•°æ®ã€æˆæ‰¹åˆ·å…¥ç£ç›˜ï¼Œè€Œä¸æ˜¯é€æ¡å†™å…¥æ•°æ®ä»Žè€Œé€ æˆå¾ˆå¤šå•æ¬¡ç£ç›˜è®¿é—®ã€‚

è¦è®°ä½ï¼Œ**ç¼“å†²åŒºä¿å­˜çš„æ˜¯é¡µï¼ˆæœ€å°çš„æ•°æ®å•ä½ï¼‰è€Œä¸æ˜¯è¡Œï¼ˆé€»è¾‘ä¸Š/äººç±»ä¹ æƒ¯çš„è§‚å¯Ÿæ•°æ®çš„æ–¹å¼ï¼‰**ã€‚ç¼“å†²æ± å†…çš„é¡µå¦‚æžœè¢«ä¿®æ”¹äº†ä½†è¿˜æ²¡æœ‰å†™å…¥ç£ç›˜ï¼Œå°±æ˜¯è„é¡µã€‚æœ‰å¾ˆå¤šç®—æ³•æ¥å†³å®šå†™å…¥è„é¡µçš„æœ€ä½³æ—¶æœºï¼Œä½†è¿™ä¸ªé—®é¢˜ä¸Žäº‹åŠ¡çš„æ¦‚å¿µé«˜åº¦å…³è”ï¼Œä¸‹é¢æˆ‘ä»¬å°±è°ˆè°ˆäº‹åŠ¡ã€‚



### äº‹åŠ¡ç®¡ç†å™¨

æœ€åŽä½†åŒæ ·é‡è¦çš„ï¼Œæ˜¯äº‹åŠ¡ç®¡ç†å™¨ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°è¿™ä¸ªè¿›ç¨‹æ˜¯å¦‚ä½•ä¿è¯æ¯ä¸ªæŸ¥è¯¢åœ¨è‡ªå·±çš„äº‹åŠ¡å†…æ‰§è¡Œçš„ã€‚ä½†å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ACIDäº‹åŠ¡çš„æ¦‚å¿µã€‚



â€œIâ€™m on acidâ€

ä¸€ä¸ªACIDäº‹åŠ¡æ˜¯ä¸€ä¸ªå·¥ä½œå•å…ƒï¼Œå®ƒè¦ä¿è¯4ä¸ªå±žæ€§ï¼š

- åŽŸå­æ€§ï¼ˆAtomicityï¼‰: äº‹åŠ¡ã€Žè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨å–æ¶ˆã€ï¼Œå³ä½¿å®ƒæŒç»­è¿è¡Œ10ä¸ªå°æ—¶ã€‚å¦‚æžœäº‹åŠ¡å´©æºƒï¼ŒçŠ¶æ€å›žåˆ°äº‹åŠ¡ä¹‹å‰ï¼ˆäº‹åŠ¡å›žæ»šï¼‰ã€‚
- ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰: åªæœ‰åˆæ³•çš„æ•°æ®ï¼ˆä¾ç…§å…³ç³»çº¦æŸå’Œå‡½æ•°çº¦æŸï¼‰èƒ½å†™å…¥æ•°æ®åº“ï¼Œä¸€è‡´æ€§ä¸ŽåŽŸå­æ€§å’Œéš”ç¦»æ€§æœ‰å…³ã€‚
- éš”ç¦»æ€§ï¼ˆIsolationï¼‰: å¦‚æžœ2ä¸ªäº‹åŠ¡ A å’Œ B åŒæ—¶è¿è¡Œï¼Œäº‹åŠ¡ A å’Œ B æœ€ç»ˆçš„ç»“æžœæ˜¯ç›¸åŒçš„ï¼Œä¸ç®¡ A æ˜¯ç»“æŸäºŽ B ä¹‹å‰/ä¹‹åŽ/è¿è¡ŒæœŸé—´ã€‚
- æŒä¹…æ€§ï¼ˆDurabilityï¼‰: ä¸€æ—¦äº‹åŠ¡æäº¤ï¼ˆä¹Ÿå°±æ˜¯æˆåŠŸæ‰§è¡Œï¼‰,ä¸ç®¡å‘ç”Ÿä»€ä¹ˆï¼ˆå´©æºƒæˆ–è€…å‡ºé”™ï¼‰ï¼Œæ•°æ®è¦ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚

åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…ï¼Œä½ å¯ä»¥è¿è¡Œå¤šä¸ªSQLæŸ¥è¯¢æ¥è¯»å–ã€åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤æ•°æ®ã€‚å½“ä¸¤ä¸ªäº‹åŠ¡ä½¿ç”¨ç›¸åŒçš„æ•°æ®ï¼Œéº»çƒ¦å°±æ¥äº†ã€‚ç»å…¸çš„ä¾‹å­æ˜¯ä»Žè´¦æˆ·Aåˆ°è´¦æˆ·Bçš„æ±‡æ¬¾ã€‚å‡è®¾æœ‰2ä¸ªäº‹åŠ¡ï¼š

- äº‹åŠ¡1ï¼ˆT1ï¼‰ä»Žè´¦æˆ·Aå–å‡º100ç¾Žå…ƒç»™è´¦æˆ·B
- äº‹åŠ¡2ï¼ˆT2ï¼‰ä»Žè´¦æˆ·Aå–å‡º50ç¾Žå…ƒç»™è´¦æˆ·B

æˆ‘ä»¬å›žæ¥çœ‹çœ‹ACIDå±žæ€§ï¼š

- åŽŸå­æ€§ç¡®ä¿ä¸ç®¡ T1 æœŸé—´å‘ç”Ÿä»€ä¹ˆï¼ˆæœåŠ¡å™¨å´©æºƒã€ç½‘ç»œä¸­æ–­â€¦ï¼‰ï¼Œä½ ä¸èƒ½å‡ºçŽ°è´¦æˆ·A å–èµ°äº†100ç¾Žå…ƒä½†æ²¡æœ‰ç»™è´¦æˆ·B çš„çŽ°è±¡ï¼ˆè¿™å°±æ˜¯æ•°æ®ä¸ä¸€è‡´çŠ¶æ€ï¼‰ã€‚
- éš”ç¦»æ€§ç¡®ä¿å¦‚æžœ T1 å’Œ T2 åŒæ—¶å‘ç”Ÿï¼Œæœ€ç»ˆAå°†å‡å°‘150ç¾Žå…ƒï¼ŒBå°†å¾—åˆ°150ç¾Žå…ƒï¼Œè€Œä¸æ˜¯å…¶ä»–ç»“æžœï¼Œæ¯”å¦‚å› ä¸º T2 éƒ¨åˆ†æŠ¹é™¤äº† T1 çš„è¡Œä¸ºï¼ŒAå‡å°‘150ç¾Žå…ƒè€ŒBåªå¾—åˆ°50ç¾Žå…ƒï¼ˆè¿™ä¹Ÿæ˜¯ä¸ä¸€è‡´çŠ¶æ€ï¼‰ã€‚
- æŒä¹…æ€§ç¡®ä¿å¦‚æžœ T1 åˆšåˆšæäº¤ï¼Œæ•°æ®åº“å°±å‘ç”Ÿå´©æºƒï¼ŒT1 ä¸ä¼šæ¶ˆå¤±å¾—æ— å½±æ— è¸ªã€‚
- ä¸€è‡´æ€§ç¡®ä¿é’±ä¸ä¼šåœ¨ç³»ç»Ÿå†…ç”Ÿæˆæˆ–ç­å¤±ã€‚



### å¹¶å‘æŽ§åˆ¶

ç¡®ä¿éš”ç¦»æ€§ã€ä¸€è‡´æ€§å’ŒåŽŸå­æ€§çš„çœŸæ­£é—®é¢˜æ˜¯**å¯¹ç›¸åŒæ•°æ®çš„å†™æ“ä½œï¼ˆå¢žã€æ›´ã€åˆ ï¼‰**ï¼š

- å¦‚æžœæ‰€æœ‰äº‹åŠ¡åªæ˜¯è¯»å–æ•°æ®ï¼Œå®ƒä»¬å¯ä»¥åŒæ—¶å·¥ä½œï¼Œä¸ä¼šæ›´æ”¹å¦ä¸€ä¸ªäº‹åŠ¡çš„è¡Œä¸ºã€‚
- å¦‚æžœï¼ˆè‡³å°‘ï¼‰æœ‰ä¸€ä¸ªäº‹åŠ¡åœ¨ä¿®æ”¹å…¶ä»–äº‹åŠ¡è¯»å–çš„æ•°æ®ï¼Œæ•°æ®åº“éœ€è¦æ‰¾ä¸ªåŠžæ³•å¯¹å…¶å®ƒäº‹åŠ¡éšè—è¿™ç§ä¿®æ”¹ã€‚è€Œä¸”ï¼Œå®ƒè¿˜éœ€è¦ç¡®ä¿è¿™ä¸ªä¿®æ”¹æ“ä½œä¸ä¼šè¢«å¦ä¸€ä¸ªçœ‹ä¸åˆ°è¿™äº›æ•°æ®ä¿®æ”¹çš„äº‹åŠ¡æ“¦é™¤ã€‚

è¿™ä¸ªé—®é¢˜å«**å¹¶å‘æŽ§åˆ¶**ã€‚

æœ€ç®€å•çš„è§£å†³åŠžæ³•æ˜¯ä¾æ¬¡æ‰§è¡Œæ¯ä¸ªäº‹åŠ¡ï¼ˆå³é¡ºåºæ‰§è¡Œï¼‰ï¼Œä½†è¿™æ ·å°±å®Œå…¨æ²¡æœ‰ä¼¸ç¼©æ€§äº†ï¼Œåœ¨ä¸€ä¸ªå¤šå¤„ç†å™¨/å¤šæ ¸æœåŠ¡å™¨ä¸Šåªæœ‰ä¸€ä¸ªæ ¸å¿ƒåœ¨å·¥ä½œï¼Œæ•ˆçŽ‡å¾ˆä½Žã€‚

- ç†æƒ³çš„åŠžæ³•æ˜¯ï¼Œæ¯æ¬¡ä¸€ä¸ªäº‹åŠ¡åˆ›å»ºæˆ–å–æ¶ˆæ—¶ï¼š
- ç›‘æŽ§æ‰€æœ‰äº‹åŠ¡çš„æ‰€æœ‰æ“ä½œ
- æ£€æŸ¥æ˜¯å¦2ä¸ªï¼ˆæˆ–æ›´å¤šï¼‰äº‹åŠ¡çš„éƒ¨åˆ†æ“ä½œå› ä¸ºè¯»å–/ä¿®æ”¹ç›¸åŒçš„æ•°æ®è€Œå­˜åœ¨å†²çª
- é‡æ–°ç¼–æŽ’å†²çªäº‹åŠ¡ä¸­çš„æ“ä½œæ¥å‡å°‘å†²çªçš„éƒ¨åˆ†
- æŒ‰ç…§ä¸€å®šçš„é¡ºåºæ‰§è¡Œå†²çªçš„éƒ¨åˆ†ï¼ˆåŒæ—¶éžå†²çªäº‹åŠ¡ä»ç„¶åœ¨å¹¶å‘è¿è¡Œï¼‰
- è€ƒè™‘äº‹åŠ¡æœ‰å¯èƒ½è¢«å–æ¶ˆ

ç”¨æ›´æ­£è§„çš„è¯´æ³•ï¼Œè¿™æ˜¯å¯¹å†²çªçš„è°ƒåº¦é—®é¢˜ã€‚æ›´å…·ä½“ç‚¹å„¿è¯´ï¼Œè¿™æ˜¯ä¸ªéžå¸¸å›°éš¾è€Œä¸”CPUå¼€é”€å¾ˆå¤§çš„ä¼˜åŒ–é—®é¢˜ã€‚ä¼ä¸šçº§æ•°æ®åº“æ— æ³•æ‰¿æ‹…ç­‰å¾…å‡ ä¸ªå°æ—¶ï¼Œæ¥å¯»æ‰¾æ¯ä¸ªæ–°äº‹åŠ¡æ´»åŠ¨æœ€å¥½çš„è°ƒåº¦ï¼Œå› æ­¤å°±ä½¿ç”¨ä¸é‚£ä¹ˆç†æƒ³çš„æ–¹å¼ä»¥é¿å…æ›´å¤šçš„æ—¶é—´æµªè´¹åœ¨è§£å†³å†²çªä¸Šã€‚



### é”ç®¡ç†å™¨

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¤šæ•°æ•°æ®åº“ä½¿ç”¨**é”**å’Œ/æˆ–**æ•°æ®ç‰ˆæœ¬æŽ§åˆ¶**ã€‚è¿™æ˜¯ä¸ªå¾ˆå¤§çš„è¯é¢˜ï¼Œæˆ‘ä¼šé›†ä¸­æŽ¢è®¨é”ï¼Œå’Œä¸€ç‚¹ç‚¹æ•°æ®ç‰ˆæœ¬æŽ§åˆ¶ã€‚

#### æ‚²è§‚é”

åŽŸç†æ˜¯ï¼š

- å¦‚æžœä¸€ä¸ªäº‹åŠ¡éœ€è¦ä¸€æ¡æ•°æ®,å®ƒå°±æŠŠæ•°æ®é”ä½
- å¦‚æžœå¦ä¸€ä¸ªäº‹åŠ¡ä¹Ÿéœ€è¦è¿™æ¡æ•°æ®, å®ƒå°±å¿…é¡»è¦ç­‰ç¬¬ä¸€ä¸ªäº‹åŠ¡é‡Šæ”¾è¿™æ¡æ•°æ®

è¿™ä¸ªé”å«**æŽ’ä»–é”**ã€‚

ä½†æ˜¯å¯¹ä¸€ä¸ªä»…ä»…è¯»å–æ•°æ®çš„äº‹åŠ¡ä½¿ç”¨æŽ’ä»–é”éžå¸¸æ˜‚è´µï¼Œå› ä¸ºè¿™ä¼šè¿«ä½¿å…¶å®ƒåªéœ€è¦è¯»å–ç›¸åŒæ•°æ®çš„äº‹åŠ¡ç­‰å¾…ã€‚å› æ­¤å°±æœ‰äº†å¦ä¸€ç§é”ï¼Œ**å…±äº«é”**ã€‚

**å…±äº«é”æ˜¯è¿™æ ·çš„**ï¼š

- å¦‚æžœä¸€ä¸ªäº‹åŠ¡åªéœ€è¦è¯»å–æ•°æ®A, å®ƒä¼šç»™æ•°æ®AåŠ ä¸Šã€Žå…±äº«é”ã€å¹¶è¯»å–
- å¦‚æžœç¬¬äºŒä¸ªäº‹åŠ¡ä¹Ÿéœ€è¦ä»…ä»…è¯»å–æ•°æ®A, å®ƒä¼šç»™æ•°æ®AåŠ ä¸Šã€Žå…±äº«é”ã€å¹¶è¯»å–
- å¦‚æžœç¬¬ä¸‰ä¸ªäº‹åŠ¡éœ€è¦ä¿®æ”¹æ•°æ®A, å®ƒä¼šç»™æ•°æ®AåŠ ä¸Šã€ŽæŽ’ä»–é”ã€ï¼Œä½†æ˜¯å¿…é¡»ç­‰å¾…å¦å¤–ä¸¤ä¸ªäº‹åŠ¡é‡Šæ”¾å®ƒä»¬çš„å…±äº«é”ã€‚

åŒæ ·çš„ï¼Œå¦‚æžœä¸€å—æ•°æ®è¢«åŠ ä¸ŠæŽ’ä»–é”ï¼Œä¸€ä¸ªåªéœ€è¦è¯»å–è¯¥æ•°æ®çš„äº‹åŠ¡å¿…é¡»ç­‰å¾…æŽ’ä»–é”é‡Šæ”¾æ‰èƒ½ç»™è¯¥æ•°æ®åŠ ä¸Šå…±äº«é”ã€‚

![sb-sql-learn-14](Images/sb-sql-learn-14.png)





é”ç®¡ç†å™¨æ˜¯æ·»åŠ å’Œé‡Šæ”¾é”çš„è¿›ç¨‹ï¼Œåœ¨å†…éƒ¨ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ä¿å­˜é”ä¿¡æ¯ï¼ˆå…³é”®å­—æ˜¯è¢«é”çš„æ•°æ®ï¼‰ï¼Œå¹¶ä¸”äº†è§£æ¯ä¸€å—æ•°æ®æ˜¯ï¼š

- è¢«å“ªä¸ªäº‹åŠ¡åŠ çš„é”
- å“ªä¸ªäº‹åŠ¡åœ¨ç­‰å¾…æ•°æ®è§£é”



#### æ­»é”

ä½†æ˜¯ä½¿ç”¨é”ä¼šå¯¼è‡´ä¸€ç§æƒ…å†µï¼Œ2ä¸ªäº‹åŠ¡æ°¸è¿œåœ¨ç­‰å¾…ä¸€å—æ•°æ®ï¼š

![sb-sql-learn-15](Images/sb-sql-learn-15.png)



åœ¨æœ¬å›¾ä¸­ï¼š

- äº‹åŠ¡A ç»™ æ•°æ®1 åŠ ä¸ŠæŽ’ä»–é”å¹¶ä¸”ç­‰å¾…èŽ·å–æ•°æ®2
- äº‹åŠ¡B ç»™ æ•°æ®2 åŠ ä¸ŠæŽ’ä»–é”å¹¶ä¸”ç­‰å¾…èŽ·å–æ•°æ®1

è¿™å«**æ­»é”**ã€‚

åœ¨æ­»é”å‘ç”Ÿæ—¶ï¼Œé”ç®¡ç†å™¨è¦é€‰æ‹©å–æ¶ˆï¼ˆå›žæ»šï¼‰ä¸€ä¸ªäº‹åŠ¡ï¼Œä»¥ä¾¿æ¶ˆé™¤æ­»é”ã€‚è¿™å¯æ˜¯ä¸ªè‰°éš¾çš„å†³å®šï¼š

- æ€æ­»æ•°æ®ä¿®æ”¹é‡æœ€å°‘çš„äº‹åŠ¡ï¼ˆè¿™æ ·èƒ½å‡å°‘å›žæ»šçš„æˆæœ¬ï¼‰ï¼Ÿ
- æ€æ­»æŒç»­æ—¶é—´æœ€çŸ­çš„äº‹åŠ¡ï¼Œå› ä¸ºå…¶å®ƒäº‹åŠ¡çš„ç”¨æˆ·ç­‰çš„æ—¶é—´æ›´é•¿ï¼Ÿ
- æ€æ­»èƒ½ç”¨æ›´å°‘æ—¶é—´ç»“æŸçš„äº‹åŠ¡ï¼ˆé¿å…å¯èƒ½çš„èµ„æºé¥¥è’ï¼‰ï¼Ÿ
- ä¸€æ—¦å‘ç”Ÿå›žæ»šï¼Œæœ‰å¤šå°‘äº‹åŠ¡ä¼šå—åˆ°å›žæ»šçš„å½±å“ï¼Ÿ

åœ¨ä½œå‡ºé€‰æ‹©ä¹‹å‰ï¼Œé”ç®¡ç†å™¨éœ€è¦æ£€æŸ¥æ˜¯å¦æœ‰æ­»é”å­˜åœ¨ã€‚

å“ˆå¸Œè¡¨å¯ä»¥çœ‹ä½œæ˜¯ä¸ªå›¾è¡¨ï¼ˆè§ä¸Šæ–‡å›¾ï¼‰ï¼Œå›¾ä¸­å‡ºçŽ°å¾ªçŽ¯å°±è¯´æ˜Žæœ‰æ­»é”ã€‚ç”±äºŽæ£€æŸ¥å¾ªçŽ¯æ˜¯æ˜‚è´µçš„ï¼ˆæ‰€æœ‰é”ç»„æˆçš„å›¾è¡¨æ˜¯å¾ˆåºžå¤§çš„ï¼‰ï¼Œç»å¸¸ä¼šé€šè¿‡ç®€å•çš„é€”å¾„è§£å†³ï¼š**ä½¿ç”¨è¶…æ—¶è®¾å®š**ã€‚å¦‚æžœä¸€ä¸ªé”åœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰åŠ ä¸Šï¼Œé‚£äº‹åŠ¡å°±è¿›å…¥æ­»é”çŠ¶æ€ã€‚

é”ç®¡ç†å™¨ä¹Ÿå¯ä»¥åœ¨åŠ é”ä¹‹å‰æ£€æŸ¥è¯¥é”ä¼šä¸ä¼šå˜æˆæ­»é”ï¼Œä½†æ˜¯æƒ³è¦å®Œç¾Žçš„åšåˆ°è¿™ä¸€ç‚¹è¿˜æ˜¯å¾ˆæ˜‚è´µçš„ã€‚å› æ­¤è¿™äº›é¢„æ£€ç»å¸¸è®¾ç½®ä¸€äº›åŸºæœ¬è§„åˆ™ã€‚



#### ä¸¤æ®µé”

å®žçŽ°çº¯ç²¹çš„éš”ç¦»æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼šäº‹åŠ¡å¼€å§‹æ—¶èŽ·å–é”ï¼Œç»“æŸæ—¶é‡Šæ”¾é”ã€‚å°±æ˜¯è¯´ï¼Œäº‹åŠ¡å¼€å§‹å‰å¿…é¡»ç­‰å¾…ç¡®ä¿è‡ªå·±èƒ½åŠ ä¸Šæ‰€æœ‰çš„é”ï¼Œå½“äº‹åŠ¡ç»“æŸæ—¶é‡Šæ”¾è‡ªå·±æŒæœ‰çš„é”ã€‚è¿™æ˜¯è¡Œå¾—é€šçš„ï¼Œä½†æ˜¯ä¸ºäº†ç­‰å¾…æ‰€æœ‰çš„é”ï¼Œå¤§é‡çš„æ—¶é—´è¢«æµªè´¹äº†ã€‚



æ›´å¿«çš„æ–¹æ³•æ˜¯**ä¸¤æ®µé”åè®®**ï¼ˆTwo-Phase Locking Protocolï¼Œç”± DB2 å’Œ SQL Serverä½¿ç”¨ï¼‰ï¼Œåœ¨è¿™é‡Œï¼Œäº‹åŠ¡åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š

- **æˆé•¿é˜¶æ®µ**ï¼šäº‹åŠ¡å¯ä»¥èŽ·å¾—é”ï¼Œä½†ä¸èƒ½é‡Šæ”¾é”ã€‚
- **æ”¶ç¼©é˜¶æ®µ**ï¼šäº‹åŠ¡å¯ä»¥é‡Šæ”¾é”ï¼ˆå¯¹äºŽå·²ç»å¤„ç†å®Œè€Œä¸”ä¸ä¼šå†æ¬¡å¤„ç†çš„æ•°æ®ï¼‰ï¼Œä½†ä¸èƒ½èŽ·å¾—æ–°é”ã€‚

![sb-sql-learn-16](Images/sb-sql-learn-16.png)

è¿™ä¸¤æ¡ç®€å•è§„åˆ™èƒŒåŽçš„è¿‡ç¨‹æ˜¯ï¼š

- é‡Šæ”¾ä¸å†ä½¿ç”¨çš„é”ï¼Œæ¥é™ä½Žå…¶å®ƒäº‹åŠ¡çš„ç­‰å¾…æ—¶é—´
- é˜²æ­¢å‘ç”Ÿè¿™ç±»æƒ…å†µï¼šäº‹åŠ¡æœ€åˆèŽ·å¾—çš„æ•°æ®ï¼Œåœ¨äº‹åŠ¡å¼€å§‹åŽè¢«ä¿®æ”¹ï¼Œå½“äº‹åŠ¡é‡æ–°è¯»å–è¯¥æ•°æ®æ—¶å‘ç”Ÿä¸ä¸€è‡´ã€‚

è¿™ä¸ªè§„åˆ™å¯ä»¥å¾ˆå¥½åœ°å·¥ä½œï¼Œä½†æœ‰ä¸ªä¾‹å¤–ï¼šå¦‚æžœä¿®æ”¹äº†ä¸€æ¡æ•°æ®ã€é‡Šæ”¾äº†å…³è”çš„é”åŽï¼Œäº‹åŠ¡è¢«å–æ¶ˆï¼ˆå›žæ»šï¼‰ï¼Œè€Œå¦ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°äº†ä¿®æ”¹åŽçš„å€¼ï¼Œä½†æœ€åŽè¿™ä¸ªå€¼å´è¢«å›žæ»šã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œ**æ‰€æœ‰ç‹¬å é”å¿…é¡»åœ¨äº‹åŠ¡ç»“æŸæ—¶é‡Šæ”¾**ã€‚





#### æ›´å¤š

å½“ç„¶äº†ï¼ŒçœŸå®žçš„æ•°æ®åº“ä½¿ç”¨æ›´å¤æ‚çš„ç³»ç»Ÿï¼Œæ¶‰åŠåˆ°æ›´å¤šç±»åž‹çš„é”ï¼ˆæ¯”å¦‚æ„å‘é”ï¼Œintention locksï¼‰å’Œæ›´å¤šçš„ç²’åº¦ï¼ˆè¡Œçº§é”ã€é¡µçº§é”ã€åˆ†åŒºé”ã€è¡¨é”ã€è¡¨ç©ºé—´é”ï¼‰ï¼Œä½†æ˜¯æ€è·¯æ˜¯ç›¸åŒçš„ã€‚



æˆ‘åªæŽ¢è®¨çº¯ç²¹åŸºäºŽé”çš„æ–¹æ³•ï¼Œ**æ•°æ®ç‰ˆæœ¬æŽ§åˆ¶æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„å¦ä¸€ä¸ªæ–¹æ³•**ã€‚

ç‰ˆæœ¬æŽ§åˆ¶æ˜¯è¿™æ ·çš„ï¼š

- æ¯ä¸ªäº‹åŠ¡å¯ä»¥åœ¨ç›¸åŒæ—¶åˆ»ä¿®æ”¹ç›¸åŒçš„æ•°æ®
- æ¯ä¸ªäº‹åŠ¡æœ‰è‡ªå·±çš„æ•°æ®æ‹·è´ï¼ˆæˆ–è€…å«ç‰ˆæœ¬ï¼‰
- å¦‚æžœ2ä¸ªäº‹åŠ¡ä¿®æ”¹ç›¸åŒçš„æ•°æ®ï¼ŒåªæŽ¥å—ä¸€ä¸ªä¿®æ”¹ï¼Œå¦ä¸€ä¸ªå°†è¢«æ‹’ç»ï¼Œç›¸å…³çš„äº‹åŠ¡å›žæ»šï¼ˆæˆ–é‡æ–°è¿è¡Œï¼‰

è¿™å°†æé«˜æ€§èƒ½ï¼Œå› ä¸ºï¼š

- è¯»äº‹åŠ¡ä¸ä¼šé˜»å¡žå†™äº‹åŠ¡
- å†™äº‹åŠ¡ä¸ä¼šé˜»å¡žè¯»
- æ²¡æœ‰ã€Žè‡ƒè‚¿ç¼“æ…¢ã€çš„é”ç®¡ç†å™¨å¸¦æ¥çš„é¢å¤–å¼€é”€

é™¤äº†ä¸¤ä¸ªäº‹åŠ¡å†™ç›¸åŒæ•°æ®çš„æ—¶å€™ï¼Œæ•°æ®ç‰ˆæœ¬æŽ§åˆ¶å„ä¸ªæ–¹é¢éƒ½æ¯”é”è¡¨çŽ°å¾—æ›´å¥½ã€‚åªä¸è¿‡ï¼Œä½ å¾ˆå¿«å°±ä¼šå‘çŽ°ç£ç›˜ç©ºé—´æ¶ˆè€—å·¨å¤§ã€‚

**æ•°æ®ç‰ˆæœ¬æŽ§åˆ¶å’Œé”æœºåˆ¶æ˜¯ä¸¤ç§ä¸åŒçš„è§è§£**ï¼šä¹è§‚é”å’Œæ‚²è§‚é”ã€‚ä¸¤è€…å„æœ‰åˆ©å¼Šï¼Œå®Œå…¨å–å†³äºŽä½¿ç”¨åœºæ™¯ï¼ˆè¯»å¤šè¿˜æ˜¯å†™å¤šï¼‰ã€‚



ä¸€äº›æ•°æ®åº“ï¼Œæ¯”å¦‚DB2ï¼ˆç›´åˆ°ç‰ˆæœ¬ 9.7ï¼‰å’Œ SQL Serverï¼ˆä¸å«å¿«ç…§éš”ç¦»ï¼‰ä»…ä½¿ç”¨é”æœºåˆ¶ã€‚å…¶ä»–çš„åƒPostgreSQL, MySQL å’Œ Oracle ä½¿ç”¨é”å’Œé¼ æ ‡ç‰ˆæœ¬æŽ§åˆ¶æ··åˆæœºåˆ¶ã€‚



### æ—¥å¿—ç®¡ç†å™¨

æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼Œæ•°æ®åº“æŠŠæ•°æ®ä¿å­˜åœ¨å†…å­˜ç¼“å†²åŒºå†…ã€‚ä½†å¦‚æžœå½“äº‹åŠ¡æäº¤æ—¶æœåŠ¡å™¨å´©æºƒï¼Œå´©æºƒæ—¶è¿˜åœ¨å†…å­˜é‡Œçš„æ•°æ®ä¼šä¸¢å¤±ï¼Œè¿™ç ´åäº†äº‹åŠ¡çš„æŒä¹…æ€§ã€‚ä½ å¯ä»¥æŠŠæ‰€æœ‰æ•°æ®éƒ½å†™åœ¨ç£ç›˜ä¸Šï¼Œä½†æ˜¯å¦‚æžœæœåŠ¡å™¨å´©æºƒï¼Œæœ€ç»ˆæ•°æ®å¯èƒ½åªæœ‰éƒ¨åˆ†å†™å…¥ç£ç›˜ï¼Œè¿™ç ´åäº†äº‹åŠ¡çš„åŽŸå­æ€§ã€‚

**äº‹åŠ¡ä½œå‡ºçš„ä»»ä½•ä¿®æ”¹å¿…é¡»æ˜¯æˆ–è€…æ’¤é”€ï¼Œæˆ–è€…å®Œæˆ**ã€‚

æœ‰ 2 ä¸ªåŠžæ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

- **å½±å­å‰¯æœ¬/é¡µï¼ˆShadow copies/pagesï¼‰**ï¼šæ¯ä¸ªäº‹åŠ¡åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“å‰¯æœ¬ï¼ˆæˆ–éƒ¨åˆ†æ•°æ®åº“çš„å‰¯æœ¬ï¼‰ï¼Œå¹¶åŸºäºŽè¿™ä¸ªå‰¯æœ¬æ¥å·¥ä½œã€‚ä¸€æ—¦å‡ºé”™ï¼Œè¿™ä¸ªå‰¯æœ¬å°±è¢«ç§»é™¤ï¼›ä¸€æ—¦æˆåŠŸï¼Œæ•°æ®åº“ç«‹å³ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ä¸ªæŠŠæˆï¼ŒæŠŠå‰¯æœ¬æ›¿æ¢åˆ°æ•°æ®ä¸­ï¼Œç„¶åŽåˆ æŽ‰ã€Žæ—§ã€æ•°æ®ã€‚
- **äº‹åŠ¡æ—¥å¿—ï¼ˆTransaction logï¼‰**ï¼šäº‹åŠ¡æ—¥å¿—æ˜¯ä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œåœ¨æ¯æ¬¡å†™ç›˜ä¹‹å‰ï¼Œæ•°æ®åº“åœ¨äº‹åŠ¡æ—¥å¿—ä¸­å†™å…¥ä¸€äº›ä¿¡æ¯ï¼Œè¿™æ ·å½“äº‹åŠ¡å´©æºƒæˆ–å›žæ»šï¼Œæ•°æ®åº“çŸ¥é“å¦‚ä½•ç§»é™¤æˆ–å®Œæˆå°šæœªå®Œæˆçš„äº‹åŠ¡ã€‚



#### WALï¼ˆé¢„å†™å¼æ—¥å¿—ï¼‰

å½±å­å‰¯æœ¬/é¡µåœ¨è¿è¡Œè¾ƒå¤šäº‹åŠ¡çš„å¤§åž‹æ•°æ®åº“æ—¶åˆ¶é€ äº†å¤§é‡ç£ç›˜å¼€é”€ï¼Œæ‰€ä»¥çŽ°ä»£æ•°æ®åº“ä½¿ç”¨**äº‹åŠ¡æ—¥å¿—**ã€‚äº‹åŠ¡æ—¥å¿—å¿…é¡»ä¿å­˜åœ¨**ç¨³å®šçš„å­˜å‚¨**ä¸Šï¼Œæˆ‘ä¸ä¼šæ·±æŒ–å­˜å‚¨æŠ€æœ¯ï¼Œä½†è‡³å°‘RAIDç£ç›˜æ˜¯å¿…é¡»çš„ï¼Œä»¥é˜²ç£ç›˜æ•…éšœã€‚



å¤šæ•°æ•°æ®åº“ï¼ˆè‡³å°‘æ˜¯Oracle,SQL Server,DB2,PostgreSQL, MySQL å’ŒSQLite) ä½¿ç”¨é¢„å†™æ—¥å¿—åè®®ï¼ˆWrite-Ahead Logging protocol ï¼ŒWALï¼‰æ¥å¤„ç†äº‹åŠ¡æ—¥å¿—ã€‚WALåè®®æœ‰ 3 ä¸ªè§„åˆ™ï¼š

- æ¯ä¸ªå¯¹æ•°æ®åº“çš„ä¿®æ”¹éƒ½äº§ç”Ÿä¸€æ¡æ—¥å¿—è®°å½•ï¼Œåœ¨æ•°æ®å†™å…¥ç£ç›˜ä¹‹å‰æ—¥å¿—è®°å½•å¿…é¡»å†™å…¥äº‹åŠ¡æ—¥å¿—ã€‚
- æ—¥å¿—è®°å½•å¿…é¡»æŒ‰é¡ºåºå†™å…¥ï¼›è®°å½• A å‘ç”Ÿåœ¨è®°å½• B ä¹‹å‰ï¼Œåˆ™ A å¿…é¡»å†™åœ¨ B ä¹‹å‰ã€‚
- å½“ä¸€ä¸ªäº‹åŠ¡æäº¤æ—¶ï¼Œåœ¨äº‹åŠ¡æˆåŠŸä¹‹å‰ï¼Œæäº¤é¡ºåºå¿…é¡»å†™å…¥åˆ°äº‹åŠ¡æ—¥å¿—ã€‚

![sb-sql-learn-17](Images/sb-sql-learn-17.png)



#### ARIES

1992å¹´ï¼ŒIBM ç ”ç©¶äººå‘˜ã€Žå‘æ˜Žã€äº†WALçš„å¢žå¼ºç‰ˆï¼Œå« ARIESã€‚ARIES æˆ–å¤šæˆ–å°‘åœ°åœ¨çŽ°ä»£æ•°æ®åº“ä¸­ä½¿ç”¨ï¼Œé€»è¾‘æœªå¿…ç›¸åŒï¼Œä½†AIRESèƒŒåŽçš„æ¦‚å¿µæ— å¤„ä¸åœ¨ã€‚ARIES ä»£è¡¨ã€Žæ•°æ®åº“æ¢å¤åŽŸåž‹ç®—æ³•ã€ï¼ˆAlgorithms forRecovery andIsolationExploitingSemanticsï¼‰ã€‚



è¿™ä¸ªæŠ€æœ¯è¦è¾¾åˆ°ä¸€ä¸ªåŒé‡ç›®æ ‡ï¼š

- å†™æ—¥å¿—çš„åŒæ—¶ä¿æŒè‰¯å¥½æ€§èƒ½
- å¿«é€Ÿå’Œå¯é çš„æ•°æ®æ¢å¤

æœ‰å¤šä¸ªåŽŸå› è®©æ•°æ®åº“ä¸å¾—ä¸å›žæ»šäº‹åŠ¡ï¼š

- å› ä¸ºç”¨æˆ·å–æ¶ˆ
- å› ä¸ºæœåŠ¡å™¨æˆ–ç½‘ç»œæ•…éšœ
- å› ä¸ºäº‹åŠ¡ç ´åäº†æ•°æ®åº“å®Œæ•´æ€§ï¼ˆæ¯”å¦‚ä¸€ä¸ªåˆ—æœ‰å”¯ä¸€æ€§çº¦æŸè€Œäº‹åŠ¡æ·»åŠ äº†é‡å¤å€¼ï¼‰
- å› ä¸ºæ­»é”



#### æ—¥å¿—

æœ‰æ—¶å€™ï¼ˆæ¯”å¦‚ç½‘ç»œå‡ºçŽ°æ•…éšœï¼‰ï¼Œæ•°æ®åº“å¯ä»¥æ¢å¤äº‹åŠ¡ã€‚è¿™æ€Žä¹ˆå¯èƒ½å‘¢ï¼Ÿä¸ºäº†å›žç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£æ—¥å¿—é‡Œä¿å­˜çš„ä¿¡æ¯ã€‚



äº‹åŠ¡çš„**æ¯ä¸€ä¸ªæ“ä½œï¼ˆå¢ž/åˆ /æ”¹ï¼‰äº§ç”Ÿä¸€æ¡æ—¥å¿—**ï¼Œç”±å¦‚ä¸‹å†…å®¹ç»„æˆï¼š

- LSNï¼šä¸€ä¸ªå”¯ä¸€çš„æ—¥å¿—åºåˆ—å·ï¼ˆLog Sequence Numberï¼‰ã€‚LSNæ˜¯æŒ‰æ—¶é—´é¡ºåºåˆ†é…çš„ï¼Œè¿™æ„å‘³ç€å¦‚æžœæ“ä½œ A å…ˆäºŽæ“ä½œ Bï¼Œlog A çš„ LSN è¦æ¯” log B çš„ LSN å°ã€‚
- TransIDï¼šäº§ç”Ÿæ“ä½œçš„äº‹åŠ¡IDã€‚
- PageIDï¼šè¢«ä¿®æ”¹çš„æ•°æ®åœ¨ç£ç›˜ä¸Šçš„ä½ç½®ã€‚ç£ç›˜æ•°æ®çš„æœ€å°å•ä½æ˜¯é¡µï¼Œæ‰€ä»¥æ•°æ®çš„ä½ç½®å°±æ˜¯å®ƒæ‰€å¤„é¡µçš„ä½ç½®ã€‚
- PrevLSNï¼šåŒä¸€ä¸ªäº‹åŠ¡äº§ç”Ÿçš„ä¸Šä¸€æ¡æ—¥å¿—è®°å½•çš„é“¾æŽ¥ã€‚
- UNDOï¼šå–æ¶ˆæœ¬æ¬¡æ“ä½œçš„æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œå¦‚æžœæ“ä½œæ˜¯ä¸€æ¬¡æ›´æ–°ï¼ŒUNDOå°†æˆ–è€…ä¿å­˜å…ƒç´ æ›´æ–°å‰çš„å€¼/çŠ¶æ€ï¼ˆç‰©ç†UNDOï¼‰ï¼Œæˆ–è€…å›žåˆ°åŽŸæ¥çŠ¶æ€çš„åå‘æ“ä½œï¼ˆ**é€»è¾‘UNDO**, åªä½¿ç”¨é€»è¾‘UNDOï¼Œå› ä¸ºå¤„ç†ç‰©ç†UNDOå¤ªè¿‡æ··ä¹±äº†)ã€‚
- REDOï¼šé‡å¤æœ¬æ¬¡æ“ä½œçš„æ–¹æ³•ã€‚ åŒæ ·çš„ï¼Œæœ‰ 2 ç§æ–¹æ³•ï¼šæˆ–è€…ä¿å­˜æ“ä½œåŽçš„å…ƒç´ å€¼/çŠ¶æ€ï¼Œæˆ–è€…ä¿å­˜æ“ä½œæœ¬èº«ä»¥ä¾¿é‡å¤ã€‚
- â€¦ï¼šï¼ˆä¾›æ‚¨å‚è€ƒï¼Œä¸€ä¸ª ARIES æ—¥å¿—è¿˜æœ‰ 2 ä¸ªå­—æ®µï¼šUndoNxtLSN å’Œ Typeï¼‰ã€‚

ç£ç›˜ä¸Šæ¯ä¸ªé¡µï¼ˆä¿å­˜æ•°æ®çš„ï¼Œä¸æ˜¯ä¿å­˜æ—¥å¿—çš„ï¼‰éƒ½è®°å½•ç€æœ€åŽä¸€ä¸ªä¿®æ”¹è¯¥æ•°æ®æ“ä½œçš„LSNã€‚



æ³¨ï¼šæ®æˆ‘æ‰€çŸ¥ï¼Œåªæœ‰ PostgreSQL æ²¡æœ‰ä½¿ç”¨UNDOï¼Œè€Œæ˜¯ç”¨ä¸€ä¸ªåžƒåœ¾å›žæ”¶æœåŠ¡æ¥åˆ é™¤æ—§ç‰ˆæœ¬çš„æ•°æ®ã€‚è¿™ä¸ªè·Ÿ PostgreSQL å¯¹æ•°æ®ç‰ˆæœ¬æŽ§åˆ¶çš„å®žçŽ°æœ‰å…³ã€‚



ä¸ºäº†æ›´å¥½çš„è¯´æ˜Žè¿™ä¸€ç‚¹ï¼Œè¿™æœ‰ä¸€ä¸ªç®€å•çš„æ—¥å¿—è®°å½•æ¼”ç¤ºå›¾ï¼Œæ˜¯ç”±æŸ¥è¯¢ â€œ`UPDATE FROM PERSON SET AGE = 18;`â€ äº§ç”Ÿçš„:

![sb-sql-learn-18](Images/sb-sql-learn-18.png)



æ¯æ¡æ—¥å¿—éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„LSNï¼Œé“¾æŽ¥åœ¨ä¸€èµ·çš„æ—¥å¿—å±žäºŽåŒä¸€ä¸ªäº‹åŠ¡ã€‚æ—¥å¿—æŒ‰ç…§æ—¶é—´é¡ºåºé“¾æŽ¥ï¼ˆé“¾æŽ¥åˆ—è¡¨çš„æœ€åŽä¸€æ¡æ—¥å¿—æ˜¯æœ€åŽä¸€ä¸ªæ“ä½œäº§ç”Ÿçš„ï¼‰ã€‚



#### æ—¥å¿—ç¼“å†²åŒº

ä¸ºäº†é˜²æ­¢å†™æ—¥å¿—æˆä¸ºä¸»è¦çš„ç“¶é¢ˆï¼Œæ•°æ®åº“ä½¿ç”¨äº†æ—¥å¿—ç¼“å†²åŒºã€‚

![sb-sql-learn-19](C:/Users/dsjprs/Desktop/PHO/sb-sql-learn-19.png)



å½“æŸ¥è¯¢æ‰§è¡Œå™¨è¦æ±‚åšä¸€æ¬¡ä¿®æ”¹ï¼š

- ç¼“å­˜ç®¡ç†å™¨å°†ä¿®æ”¹å­˜å…¥è‡ªå·±çš„ç¼“å†²åŒºï¼›
- æ—¥å¿—ç®¡ç†å™¨å°†ç›¸å…³çš„æ—¥å¿—å­˜å…¥è‡ªå·±çš„ç¼“å†²åŒºï¼›
- åˆ°äº†è¿™ä¸€æ­¥ï¼ŒæŸ¥è¯¢æ‰§è¡Œå™¨è®¤ä¸ºæ“ä½œå®Œæˆäº†ï¼ˆå› æ­¤å¯ä»¥è¯·æ±‚åšå¦ä¸€æ¬¡ä¿®æ”¹ï¼‰ï¼›
- æŽ¥ç€ï¼ˆä¸ä¹…ä»¥åŽï¼‰æ—¥å¿—ç®¡ç†å™¨æŠŠæ—¥å¿—å†™å…¥äº‹åŠ¡æ—¥å¿—ï¼Œä»€ä¹ˆæ—¶å€™å†™æ—¥å¿—ç”±æŸç®—æ³•æ¥å†³å®šã€‚
- æŽ¥ç€ï¼ˆä¸ä¹…ä»¥åŽï¼‰ç¼“å­˜ç®¡ç†å™¨æŠŠä¿®æ”¹å†™å…¥ç£ç›˜ï¼Œä»€ä¹ˆæ—¶å€™å†™ç›˜ç”±æŸç®—æ³•æ¥å†³å®šã€‚

**å½“äº‹åŠ¡æäº¤ï¼Œæ„å‘³ç€äº‹åŠ¡æ¯ä¸€ä¸ªæ“ä½œçš„5ä¸ªæ­¥éª¤éƒ½å®Œæˆäº†**ã€‚å†™äº‹åŠ¡æ—¥å¿—æ˜¯å¾ˆå¿«çš„ï¼Œå› ä¸ºå®ƒåªæ˜¯ã€Žåœ¨äº‹åŠ¡æ—¥å¿—æŸå¤„å¢žåŠ ä¸€æ¡æ—¥å¿—ã€ï¼›è€Œæ•°æ®å†™ç›˜å°±æ›´å¤æ‚äº†ï¼Œå› ä¸ºè¦ç”¨ã€Žèƒ½å¤Ÿå¿«é€Ÿè¯»å–çš„æ–¹å¼å†™å…¥æ•°æ®ã€ã€‚

#### STEAL å’Œ FORCE ç­–ç•¥

å‡ºäºŽæ€§èƒ½æ–¹é¢çš„åŽŸå› ï¼Œ**ç¬¬ 5 æ­¥æœ‰å¯èƒ½åœ¨æäº¤ä¹‹åŽå®Œæˆ**ï¼Œå› ä¸ºä¸€æ—¦å‘ç”Ÿå´©æºƒï¼Œè¿˜æœ‰å¯èƒ½ç”¨REDOæ—¥å¿—æ¢å¤äº‹åŠ¡ã€‚è¿™å«åš **NO-FORCEç­–ç•¥**ã€‚



æ•°æ®åº“å¯ä»¥é€‰æ‹©FORCEç­–ç•¥ï¼ˆæ¯”å¦‚ç¬¬ 5 æ­¥åœ¨æäº¤ä¹‹å‰å¿…é¡»å®Œæˆï¼‰æ¥é™ä½Žæ¢å¤æ—¶çš„è´Ÿè½½ã€‚

å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œ**è¦é€‰æ‹©æ•°æ®æ˜¯ä¸€æ­¥æ­¥çš„å†™å…¥ï¼ˆSTEALç­–ç•¥ï¼‰ï¼Œè¿˜æ˜¯ç¼“å†²ç®¡ç†å™¨éœ€è¦ç­‰å¾…æäº¤å‘½ä»¤æ¥ä¸€æ¬¡æ€§å…¨éƒ¨å†™å…¥ï¼ˆNO-STEALç­–ç•¥ï¼‰**ã€‚é€‰æ‹©STEALè¿˜æ˜¯NO-STEALå–å†³äºŽä½ æƒ³è¦ä»€ä¹ˆï¼šå¿«é€Ÿå†™å…¥ä½†æ˜¯ä»Ž UNDO æ—¥å¿—æ¢å¤ç¼“æ…¢ï¼Œè¿˜æ˜¯å¿«é€Ÿæ¢å¤ã€‚

ä¸‹é¢æ˜¯è¿™äº›ç­–ç•¥å¯¹æ¢å¤çš„å½±å“ï¼š

- **STEAL/NO-FORCE éœ€è¦ UNDO å’Œ REDO: æ€§èƒ½é«˜**ï¼Œä½†æ˜¯æ—¥å¿—å’Œæ¢å¤è¿‡ç¨‹æ›´å¤æ‚ (æ¯”å¦‚ ARIES)ã€‚å¤šæ•°æ•°æ®åº“é€‰æ‹©è¿™ä¸ªç­–ç•¥ã€‚ æ³¨ï¼šè¿™æ˜¯æˆ‘ä»Žå¤šä¸ªå­¦æœ¯è®ºæ–‡å’Œæ•™ç¨‹é‡Œçœ‹åˆ°çš„ï¼Œä½†å¹¶æ²¡æœ‰çœ‹åˆ°å®˜æ–¹æ–‡æ¡£é‡Œæ˜¾å¼è¯´æ˜Žè¿™ä¸€ç‚¹ã€‚
- STEAL/ FORCE åªéœ€è¦ UNDO.
- NO-STEAL/NO-FORCE åªéœ€è¦ REDO.
- NO-STEAL/FORCE ä»€ä¹ˆä¹Ÿä¸éœ€è¦: æ€§èƒ½æœ€å·®ï¼Œè€Œä¸”éœ€è¦å·¨å¤§çš„å†…å­˜ã€‚



#### å…³äºŽæ¢å¤

å‡è®¾æ–°æ¥çš„å®žä¹ ç”Ÿè®©æ•°æ®åº“å´©æºƒäº†ï¼Œä½ é‡å¯äº†æ•°æ®åº“ï¼Œæ¢å¤è¿‡ç¨‹å¼€å§‹äº†ã€‚

ARIESä»Žå´©æºƒä¸­æ¢å¤æœ‰ä¸‰ä¸ªé˜¶æ®µï¼š

- 1) **åˆ†æžé˜¶æ®µ**ï¼šæ¢å¤è¿›ç¨‹è¯»å–å…¨éƒ¨äº‹åŠ¡æ—¥å¿—ï¼Œæ¥é‡å»ºå´©æºƒè¿‡ç¨‹ä¸­æ‰€å‘ç”Ÿäº‹æƒ…çš„æ—¶é—´çº¿ï¼Œå†³å®šå“ªä¸ªäº‹åŠ¡è¦å›žæ»šï¼ˆæ‰€æœ‰æœªæäº¤çš„äº‹åŠ¡éƒ½è¦å›žæ»šï¼‰ã€å´©æºƒæ—¶å“ªäº›æ•°æ®éœ€è¦å†™ç›˜ã€‚
- 2) **Redoé˜¶æ®µ**ï¼šè¿™ä¸€å…³ä»Žåˆ†æžä¸­é€‰ä¸­çš„ä¸€æ¡æ—¥å¿—è®°å½•å¼€å§‹ï¼Œä½¿ç”¨ REDO æ¥å°†æ•°æ®åº“æ¢å¤åˆ°å´©æºƒä¹‹å‰çš„çŠ¶æ€ã€‚
  - åœ¨REDOé˜¶æ®µï¼ŒREDOæ—¥å¿—æŒ‰ç…§æ—¶é—´é¡ºåºå¤„ç†ï¼ˆä½¿ç”¨LSNï¼‰ã€‚
  - å¯¹æ¯ä¸€æ¡æ—¥å¿—ï¼Œæ¢å¤è¿›ç¨‹éœ€è¦è¯»å–åŒ…å«æ•°æ®çš„ç£ç›˜é¡µLSNã€‚
  - å¦‚æžœLSNï¼ˆç£ç›˜é¡µï¼‰>= LSNï¼ˆæ—¥å¿—è®°å½•ï¼‰ï¼Œè¯´æ˜Žæ•°æ®å·²ç»åœ¨å´©æºƒå‰å†™åˆ°ç£ç›˜ï¼ˆä½†æ˜¯å€¼å·²ç»è¢«æ—¥å¿—ä¹‹åŽã€å´©æºƒä¹‹å‰çš„æŸä¸ªæ“ä½œè¦†ç›–ï¼‰ï¼Œæ‰€ä»¥ä¸éœ€è¦åšä»€ä¹ˆã€‚
  - å¦‚æžœLSNï¼ˆç£ç›˜é¡µï¼‰< LSNï¼ˆæ—¥å¿—è®°å½•ï¼‰ï¼Œé‚£ä¹ˆç£ç›˜ä¸Šçš„é¡µå°†è¢«æ›´æ–°ã€‚
  - å³ä½¿å°†è¢«å›žæ»šçš„äº‹åŠ¡ï¼ŒREDOä¹Ÿæ˜¯è¦åšçš„ï¼Œå› ä¸ºè¿™æ ·ç®€åŒ–äº†æ¢å¤è¿‡ç¨‹ï¼ˆä½†æ˜¯æˆ‘ç›¸ä¿¡çŽ°ä»£æ•°æ®åº“ä¸ä¼šè¿™ä¹ˆåšçš„ï¼‰ã€‚
- \3) **Undoé˜¶æ®µ**ï¼šè¿™ä¸€é˜¶æ®µå›žæ»šæ‰€æœ‰å´©æºƒæ—¶æœªå®Œæˆçš„äº‹åŠ¡ã€‚å›žæ»šä»Žæ¯ä¸ªäº‹åŠ¡çš„æœ€åŽä¸€æ¡æ—¥å¿—å¼€å§‹ï¼Œå¹¶ä¸”æŒ‰ç…§æ—¶é—´å€’åºå¤„ç†UNDOæ—¥å¿—ï¼ˆä½¿ç”¨æ—¥å¿—è®°å½•çš„PrevLSNï¼‰ã€‚

æ¢å¤è¿‡ç¨‹ä¸­ï¼Œäº‹åŠ¡æ—¥å¿—å¿…é¡»ç•™æ„æ¢å¤è¿‡ç¨‹çš„æ“ä½œï¼Œä»¥ä¾¿å†™å…¥ç£ç›˜çš„æ•°æ®ä¸Žäº‹åŠ¡æ—¥å¿—ç›¸ä¸€è‡´ã€‚ä¸€ä¸ªè§£å†³åŠžæ³•æ˜¯ç§»é™¤è¢«å–æ¶ˆçš„äº‹åŠ¡äº§ç”Ÿçš„æ—¥å¿—è®°å½•ï¼Œä½†æ˜¯è¿™ä¸ªå¤ªå›°éš¾äº†ã€‚ç›¸åï¼ŒARIESåœ¨äº‹åŠ¡æ—¥å¿—ä¸­è®°å½•è¡¥å¿æ—¥å¿—ï¼Œæ¥é€»è¾‘ä¸Šåˆ é™¤è¢«å–æ¶ˆçš„äº‹åŠ¡çš„æ—¥å¿—è®°å½•ã€‚



å½“äº‹åŠ¡è¢«ã€Žæ‰‹å·¥ã€å–æ¶ˆï¼Œæˆ–è€…è¢«é”ç®¡ç†å™¨å–æ¶ˆï¼ˆä¸ºäº†æ¶ˆé™¤æ­»é”ï¼‰ï¼Œæˆ–ä»…ä»…å› ä¸ºç½‘ç»œæ•…éšœè€Œå–æ¶ˆï¼Œé‚£ä¹ˆåˆ†æžé˜¶æ®µå°±ä¸éœ€è¦äº†ã€‚å¯¹äºŽå“ªäº›éœ€è¦ REDO å“ªäº›éœ€è¦ UNDO çš„ä¿¡æ¯åœ¨ 2 ä¸ªå†…å­˜è¡¨ä¸­ï¼š

- äº‹åŠ¡è¡¨ï¼ˆä¿å­˜å½“å‰æ‰€æœ‰äº‹åŠ¡çš„çŠ¶æ€ï¼‰

- è„é¡µè¡¨ï¼ˆä¿å­˜å“ªäº›æ•°æ®éœ€è¦å†™å…¥ç£ç›˜ï¼‰

  

å½“æ–°çš„äº‹åŠ¡äº§ç”Ÿæ—¶ï¼Œè¿™ä¸¤ä¸ªè¡¨ç”±ç¼“å­˜ç®¡ç†å™¨å’Œäº‹åŠ¡ç®¡ç†å™¨æ›´æ–°ã€‚å› ä¸ºæ˜¯åœ¨å†…å­˜ä¸­ï¼Œå½“æ•°æ®åº“å´©æºƒæ—¶å®ƒä»¬ä¹Ÿè¢«ç ´åæŽ‰äº†ã€‚



åˆ†æžé˜¶æ®µçš„ä»»åŠ¡å°±æ˜¯åœ¨å´©æºƒä¹‹åŽï¼Œç”¨äº‹åŠ¡æ—¥å¿—ä¸­çš„ä¿¡æ¯é‡å»ºä¸Šè¿°çš„ä¸¤ä¸ªè¡¨ã€‚ä¸ºäº†åŠ å¿«åˆ†æžé˜¶æ®µï¼ŒARIESæå‡ºäº†ä¸€ä¸ªæ¦‚å¿µï¼š**æ£€æŸ¥ç‚¹ï¼ˆcheck pointï¼‰**ï¼Œå°±æ˜¯ä¸æ—¶åœ°æŠŠäº‹åŠ¡è¡¨å’Œè„é¡µè¡¨çš„å†…å®¹ï¼Œè¿˜æœ‰æ­¤æ—¶æœ€åŽä¸€æ¡LSNå†™å…¥ç£ç›˜ã€‚é‚£ä¹ˆåœ¨åˆ†æžé˜¶æ®µå½“ä¸­ï¼Œåªéœ€è¦åˆ†æžè¿™ä¸ªLSNä¹‹åŽçš„æ—¥å¿—å³å¯ã€‚

